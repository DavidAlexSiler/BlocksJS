/*! BlocksJS 0.5.32 2016-03-30

Copyright (c) 2014 William Malone (www.williammalone.com)

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/

var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.block=function(a){"use strict";var b,c=BLOCKS.eventDispatcher(),d=[],e={},f=[],g=["stack","worldX","worldY","x","y","scale","scaleX","scaleY","width","height","centerRegistrationPoint","mirrorX","mirrorY","angle","alpha","layer","visible","dirty","justTapped","justNotTapped","dragging","justReleased","tapPos","cropWidth","cropHeight","frameOffsetX","frameOffsetY","offsetX","offsetY","minHotspot","hotspots","currentFrameIndex"],h=["update","render","show","hide","pause","unpause","reset","stop","play","isPointInside","getBounds","getBoundingBox","isRectInside","gotoLastFrame","gotoFrame"],i=function(a){var b;for(a.removeEventListener("destroyed",i),b=0;b<f.length;b+=1){f[b]===a&&f.splice(b,1);break}};return a=a||{},c.name=a.name,c.addSlice=function(b){var f,h;if(h=BLOCKS.slice(b),b.name||(h.name="unnamedSlice"+d.length),d.push(h),e[b.name]=h,h.addEventListener("complete",function(){c.dispatchEvent("complete")}),1===d.length){for(f=0;f<g.length;f+=1)void 0!==a[g[f]]&&(h[g[f]]=a[g[f]]);c.setSlice(b.name)}return h},c.removeSlice=function(a,b){e[a]&&(e[a].destroy(b),e[a]=null)},c.getSlice=function(a){return void 0===a?b:e[a]},c.setSlice=function(a,c){var d,f;if(f=e[a],f&&f!==b){if(b)for(d=0;d<g.length;d+=1)"width"!==g[d]&&"height"!==g[d]&&"offsetX"!==g[d]&&"offsetY"!==g[d]&&(f[g[d]]=b[g[d]]);return b=f,b.reset(),b.autoPlay&&b.play(c),b.dirty=!0,!0}return!1},c.motorize=function(a){a.addEventListener("destroyed",i),f.push(a)},c.removeMotors=function(a){var b,c=[],d=[];for(b=0;b<f.length;b+=1)a?f[b].type===a?c.push(f[b]):d.push(f[b]):c.push(f[b]);for(b=0;b<c.length;b+=1)c[b].destroy();f=d},c.destroy=function(a){var f;if(c){for(c.removeMotors(),f=0;f<d.length;f+=1)d[f].destroy(a);d=null,e=null,b=null,c.dispatchEvent("destroyed",c),c=null}},function(){var d,e=function(a){Object.defineProperty(c,a,{get:function(){return b?b[a]:void 0},set:function(c){b&&(b[a]=c)}})},f=function(a){c[a]=function(c){return b[a](c)}};for(d=0;d<g.length;d+=1)e(g[d]);for(d=0;d<h.length;d+=1)f(h[d]);if(a.slices)for(d=0;d<a.slices.length;d+=1)c.addSlice(a.slices[d])}(),c};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.camera=function(a){"use strict";var b=BLOCKS.gear();return b.x=a&&a.x||0,b.y=a&&a.y||0,b.width=a&&a.width||1024,b.height=a&&a.height||768,b};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.clock=function(){"use strict";var a,b=BLOCKS.eventDispatcher(),c=!0,d=function(){c||(a=window.requestAnimationFrame(d),b.dispatchEvent("tick"))};return b.stop=function(){window.cancelAnimationFrame(a),c=!0},b.start=function(){c&&(c=!1,a=window.requestAnimationFrame(d))},b.destroy=function(){b&&(b.stop(),b=null)},function(){for(var a=0,b=["webkit","moz"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){window.clearTimeout(a)})}(),b};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.container=function(a){"use strict";var b=BLOCKS.eventDispatcher(),c=[],d=[],e=[],f={},g=function(a){var b;for(a.removeEventListener("destroyed",g),b=0;b<c.length;b+=1){c.splice(b,1);break}};return b.visible=!0,b.dirty=!0,b.assignLayers=function(){var b,c;for(c=Array.prototype.slice.call(arguments),f={},b=0;b<c.length;b+=1)f[c[b]]=a.getLayer(b)},b.getLayer=function(a){return f[a]?f[a]:(BLOCKS.error("Cannot find container layer: "+a),void 0)},b.addView=function(a){var c,f;for(a.addEventListener("destroyed",b.removeView),e.push(a),c=0;c<d.length;c+=1)if(a.layer===d[c]){f=!0;break}!f&&a.layer&&d.push(a.layer)},b.removeView=function(a){var c,f,g;for(a.removeEventListener("destroyed",b.removeView),c=0;c<e.length;c+=1)if(a===e[c]){f=e.layer,e.splice(c,1);break}for(c=0;c<e.length;c+=1)if(a.layer===f){g=!0;break}if(!g)for(c=0;c<d.length;c+=1)if(f===d[c]){d.splice(c,1);break}},b.setViewLayerIndex=function(a,b){var c,d;for(c=0;c<e.length;c+=1)if(e[c]===a){d=c;break}void 0===c?BLOCKS.warn("Cannot find view to set view's layer index."):(e.splice(d,1),e.splice(b,0,a),a.dirty=!0)},b.getViewLayerIndex=function(a){var b,c;for(b=0;b<e.length;b+=1)if(e[b]===a){c=b;break}return c},b.clear=function(){var a;for(a=0;a<d.length;a+=1)b.layers[a].clear()},b.motorize=function(a){a.addEventListener("destroyed",g),c.push(a)},b.removeMotors=function(a){var b,d=[];for(b=0;b<c.length;b+=1)a?c[b].type===a?c[b].destroy():d.push(c[b]):c[b].destroy();c=d},b.update=function(){var a;for(a=0;a<e.length;a+=1)e[a].update()},b.render=function(a){var c,g,h={};for(g in f)f.hasOwnProperty(g)&&(f[g].dirty||b.dirty)&&(h[f[g].name]=f[g]);for(c=0;c<d.length;c+=1)(d[c].dirty||b.dirty)&&(h[d[c].name]=d[c]);for(c=0;c<e.length;c+=1)e[c].dirty&&(h[e[c].layer.name]=e[c].layer);for(g in h)h.hasOwnProperty(g)&&h[g].clear();for(c=0;c<e.length;c+=1)h[e[c].layer.name]&&(e[c].dirty=!0),b.visible&&e[c].render(a);b.dirty=!1},b.destroy=function(){var a;for(a=0;a<e.length;a+=1)b.removeView(e[a]),e[a].destroy(),e[a]=null;e=null,d=null,c=null},b};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.controller=function(a){"use strict";var b,c=BLOCKS.eventDispatcher(),d=function(a){var b,c;return a?(c={x:a.offsetLeft,y:a.offsetTop},a.offsetParent&&(b=d(a.offsetParent),c.x+=b.x,c.y+=b.y)):c={x:0,y:0},c},e=function(){var b;document.addEventListener("keydown",g,!0),document.addEventListener("keyup",h,!0),b=a||document,b.addEventListener("orientationchange",f,!0),b.addEventListener("touchstart",j,!0),b.addEventListener("touchmove",j,!0),b.addEventListener("touchend",j,!0),b.addEventListener("touchcancel",j,!0),b.addEventListener("mousedown",k,!0),b.addEventListener("mousemove",k,!0),b.addEventListener("mouseup",k,!0),b.addEventListener("mousecancel",k,!0),b.addEventListener("mouseout",k,!0),document.addEventListener("mouseup",function(a){k(a,!0)},!1)},f=function(){if(c.listening){switch(window.orientation){case-90:c.orientation="landscape";break;case 0:c.orientation="portrait";break;case 90:c.orientation="landscape";break;case 180:c.orientation="portrait"}c.dispatchEvent("orientationChange",{orientation:c.orientation})}},g=function(a){c.listening&&c.dispatchEvent("keyDown",a)},h=function(a){c.listening&&c.dispatchEvent("keyUp",a)},i=function(a,b){switch(b){case"tap":c.drag=!0,c.dispatchEvent("tap",a);break;case"drag":c.dispatchEvent("drag",a);break;case"release":c.drag=!1,c.dispatchEvent("release",a);break;case"cancel":c.drag=!1,c.dispatchEvent("cancel",a)}},j=function(e){var f,g,h,j,k;if(c.listening){e.preventDefault&&e.preventDefault(),b=d(a),k=e.changedTouches[0],h={};for(g in k)h[g]=k[g];for(h.x=(k.pageX-b.x-c.offsetX)*c.scaleX,h.y=(k.pageY-b.y-c.offsetY)*c.scaleY,h.type=e.type,h.touches=[],f=0;f<e.touches.length;f+=1){h.touches[f]={};for(g in e.touches[f])e.touches[f].hasOwnProperty(g)&&(h.touches[f][g]=e.touches[f][g]);h.touches[f].x=(h.touches[f].clientX-b.x-c.offsetX)*c.scaleX,h.touches[f].y=(h.touches[f].clientY-b.y-c.offsetY)*c.scaleY}for(h.changedTouches=[],f=0;f<e.changedTouches.length;f+=1){h.changedTouches[f]={};for(g in e.changedTouches[f])e.changedTouches[f].hasOwnProperty(g)&&(h.changedTouches[f][g]=e.changedTouches[f][g]);h.changedTouches[f].x=(h.changedTouches[f].pageX-b.x-c.offsetX)*c.scaleX,h.changedTouches[f].y=(h.changedTouches[f].pageY-b.y-c.offsetY)*c.scaleY}switch(h.type){case"touchstart":j="tap",c.dispatchEvent("touchStart",h);break;case"touchmove":j="drag",c.dispatchEvent("touchMove",h);break;case"touchend":j="release",c.dispatchEvent("touchEnd",h);break;case"touchcancel":j="cancel",c.dispatchEvent("touchCancel",h)}i(h,j)}},k=function(e,f){var g,h,j;if(c.listening){c.stopPropagation&&e.stopPropagation(),j={};for(g in e)j[g]=e[g];switch(b=d(a),j.x=(j.pageX-b.x-c.offsetX)*c.scaleX,j.y=(j.pageY-b.y-c.offsetY)*c.scaleY,j.identifier="mouse",j.touches=[j],j.changedTouches=[j],f&&(j.type+="outside"),j.type){case"mousedown":h="tap",c.dispatchEvent("mouseDown",j);break;case"mousemove":h="drag",c.dispatchEvent("mouseMove",j);break;case"mouseup":h="release",c.dispatchEvent("mouseUp",j);break;case"mousecancel":h="cancel",c.dispatchEvent("mouseCancel",j);break;case"mouseout":return h="mouseout",c.dispatchEvent("mouseOut",j),void 0;case"mouseupoutside":return h="mouseupoutside",c.dispatchEvent("mouseUpOutside",j),void 0}i(j,h)}};return c.scaleX=1,c.scaleY=1,c.offsetX=0,c.offsetY=0,c.listening=!0,c.stopPropagation=!0,c.simulateKeyDownEvent=function(a){g({keyCode:a})},c.simulateKeyUpEvent=function(a){h({keyCode:a})},e(),c};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.eventDispatcher=function(){"use strict";var a={},b={};return a.dispatchEvent=function(a,c){var d,e=[],f=[];if(b[a]){for(d=0;d<b[a].length;d+=1)e.push(b[a][d].callback),b[a][d].destroyOnDispatch||f.push(b[a][d]);for(b[a]=f,d=0;d<e.length;d+=1)e[d](c)}},a.addEventListener=function(a,c,d){b[a]||(b[a]=[]),b[a].push({name:a,callback:c,destroyOnDispatch:d})},a.removeEventListener=function(a,c){var d;if(b[a])for(d=0;d<b[a].length;d+=1)c?b[a][d].callback===c&&(b[a][d]=null,b[a].splice(d,1)):(b[a][d]=null,b[a].splice(d,1))},a.clearEventListeners=function(){b={}},a};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.game=function(a,b){"use strict";var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=BLOCKS.eventDispatcher(),w=BLOCKS.clock(),x=!1,y=[],z=[],A=0,B=function(){var a,b=[],c=[];for(a=0;a<z.length;a+=1)z[a].curTick+=1,z[a].curTick>=z[a].totalTicks?c.push(z[a]):b.push(z[a]);for(z=b,a=0;a<c.length;a+=1)c[a].callback(c[a].parameters)},C=function(){(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i))&&(90===window.orientation||-90===window.orientation)&&(window.scrollTo(0,0),X())},D=function(){document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?v.pause():v.unpause()},E=function(){p||(v.controller.removeEventListener("tap",E),v.dispatchEvent("firstTap"),p=!0,v.introScreen&&v.introScreen.destroyOnFirsTap!==!1&&(v.state="loading",v.introScreen.destroy(),v.introScreen=null),v.speaker.load(),W(),Z())},F=function(){n=a&&void 0!==a.scaleLandscape?a.scaleLandscape:!0,o=a&&void 0!==a.scalePortrait?a.scalePortrait:!0,v.element&&(c=document.createElement("article"),c.id="BlocksGameContainer",a&&a.minWidth&&(j=a.minWidth,c.style.minWidth=j+"px"),a&&a.minHeight&&(k=a.minHeight,c.style.minHeight=k+"px"),a&&a.maxWidth&&(m=a.maxWidth,c.style.maxWidth=m+"px"),a&&a.maxHeight&&(l=a.maxHeight,c.style.maxHeight=l+"px"),v.element.appendChild(c),e=document.createElement("article"),e.id="BlocksInteractionContainer",c.appendChild(e)),v.controller=BLOCKS.controller(e),X(),v.debug&&v.virtualKeyboardEnabled&&(f=BLOCKS.virtualKeyboard(v.controller,{layer:v.getLayer(),customKeys:a.customVirtualKeys})),window.addEventListener("orientationchange",C),window.addEventListener("resize",X),v.controller.addEventListener("keyUp",K),v.controller.addEventListener("keyDown",J),v.controller.addEventListener("tap",L),v.controller.addEventListener("drag",M),v.controller.addEventListener("release",N),v.controller.addEventListener("cancel",N),v.controller.addEventListener("touchStart",O),v.controller.addEventListener("touchMove",P),v.controller.addEventListener("touchEnd",Q),v.controller.addEventListener("touchCancel",Q),v.controller.addEventListener("mouseDown",R),v.controller.addEventListener("mouseMove",S),v.controller.addEventListener("mouseUp",T),v.controller.addEventListener("mouseCancel",T),v.controller.addEventListener("mouseOut",U),v.controller.addEventListener("mouseUpOutside",V),v.controller.addEventListener("release",E),"undefined"!=typeof document.hidden?document.addEventListener("visibilitychange",D):"undefined"!=typeof document.mozHidden?document.addEventListener("mozvisibilitychange",D):"undefined"!=typeof document.msHidden?document.addEventListener("msvisibilitychange",D):"undefined"!=typeof document.webkitHidden&&document.addEventListener("webkitvisibilitychange",D),window.onunload=v.destroy},G=function(){var a;if(!x)for(a=+new Date,i+=a-h,h=a,i>v.maxLoopDuration&&(BLOCKS.warn("Cannot keep up with game loop. Chopping "+Math.ceil((i-v.maxLoopDuration)/60)+" frames."),i=v.maxLoopDuration);i>=16.666666666666;)i-=16.666666666666,v.dispatchEvent("tick"),v.dispatchEvent("preUpdate"),v.debug&&f&&f.update(),B(),v.update(),v.dispatchEvent("postUpdate")},H=function(){var a={camera:v.camera,language:v.language};x||(v.dispatchEvent("preRender",a),v.debug&&f&&f.render(a),v.render(a),v.dispatchEvent("postRender",a))},I=function(){G(),H()},J=function(a){v.keyDown&&v.keyDown(a)},K=function(a){v.keyUp&&v.keyUp(a)},L=function(a){v.debug&&f&&(a.x<100&&a.y<100&&(g=window.setTimeout(function(){f.visible=!f.visible,f.dirty=!0},1e3)),f.onTap(a)),v.tap&&v.tap(a)},M=function(a){v.debug&&window.clearTimeout(g),v.drag&&v.drag(a)},N=function(a){v.debug&&window.clearTimeout(g),v.release&&v.release(a)},O=function(a){v.touchStart&&v.touchStart(a)},P=function(a){v.touchMove&&v.touchMove(a)},Q=function(a){v.touchEnd&&v.touchEnd(a)},R=function(a){v.mouseDown&&v.mouseDown(a)},S=function(a){v.mouseMove&&v.mouseMove(a)},T=function(a){v.mouseUp&&v.mouseUp(a)},U=function(a){v.mouseOut&&v.mouseOut(a)},V=function(a){v.mouseUpOutside&&v.mouseUpOutside(a)},W=function(){q?s||v.autoStart===!1||v.start():(v.introScreen&&p||!v.introScreen)&&v.imageLoader.isLoaded()&&(v.speaker.isReady()||0===v.speaker.getNumFiles())&&(q=!0,v.autoStart!==!1&&v.start(),v.dispatchEvent("loaded"))},X=function(){var a,b,d,e,f,g,h;for(navigator.userAgent.match(/iPhone/i)&&v.element&&v.element.offsetHeight>window.innerHeight?(window.scrollTo(0,1),h=v.element.offsetHeight-window.innerHeight*v.pixelMultiplier):h=0,b=v.element&&0===h?{width:v.element.offsetWidth,height:v.element.offsetHeight}:{width:window.innerWidth*v.pixelMultiplier,height:window.innerHeight*v.pixelMultiplier},j&&b.width<j&&(b.width=j),k&&b.height<k&&(b.height=k,b.width=j),m&&b.width>m&&(b.width=m),l&&b.height>l&&(b.height=l),!n&&90===Math.abs(window.orientation)||!o&&90!==Math.abs(window.orientation)?(e=v.height,d=v.width):v.height/v.width>b.height/b.width?v.safeHeight/v.width>b.height/b.width?(e=b.height*v.height/v.safeHeight,d=e*v.width/v.height):(d=b.width,e=d*v.height/v.width):v.height/v.safeWidth>b.height/b.width?(e=b.height,d=e*v.width/v.height):(d=b.width*v.width/v.safeWidth,e=d*v.height/v.width),f=(b.width-d)/2,g=(b.height-e)/2,v.scale=d/v.width,v.camera.offsetX=-Math.min(f,0)/v.scale,v.camera.offsetY=-Math.min(g,0)/v.scale,v.camera.width=(b.width-2*Math.max(f,0))/v.scale,v.camera.height=(b.height-2*Math.max(g,0))/v.scale,c&&(c.style.width=b.width-2*Math.max(f,0)+"px",c.style.height=b.height-2*Math.max(g,0)+"px",c.style.padding=Math.max(g,0)+"px "+Math.max(f,0)+"px "+Math.max(g,0)+"px "+Math.max(f,0)+"px"),v.controller.scaleX=v.width/d*v.pixelMultiplier,v.controller.scaleY=v.height/e*v.pixelMultiplier,v.controller.offsetX=-v.camera.offsetX*v.scale/v.pixelMultiplier,v.controller.offsetY=-v.camera.offsetY*v.scale/v.pixelMultiplier,a=0;a<v.layers.length;a+=1)v.layers[a].width=v.camera.width,v.layers[a].height=v.camera.height;!q&&v.loadingScreen&&(v.loadingScreen.dirty=!0),v.dispatchEvent("resize")},Y=function(){u||v.autoLoad!==!1&&v.load()},Z=function(){(!v.introScreen||v.introScreen.loaded)&&(!v.loadingScreen||v.loadingScreen.loaded)&&Y()};return a=a||{},v.element=void 0!==b?b:document.getElementById("BlocksGame"),v.element||document.getElementsByClassName&&document.getElementsByClassName("BlocksGame")&&(v.element=document.getElementsByClassName("BlocksGame")[0]),v.element||a.canvas||BLOCKS.error("Game does not have a game element"),v.pixelMultiplier=!v.element&&window.devicePixelRatio?window.devicePixelRatio:1,v.scale=1,v.singleLayer=void 0!==a.singleLayer?a.singleLayer:!1,v.layers=[],v.width=void 0!==a.width?a.width:1024,v.height=void 0!==a.height?a.height:768,v.safeWidth=a.safeWidth||v.width,v.safeHeight=a.safeHeight||v.height,v.debug=void 0!==a.debug?a.debug:!1,v.maxLoopDuration=void 0!==a.maxLoopDuration?a.maxLoopDuration:500,v.stage=BLOCKS.container(v),v.camera=BLOCKS.camera({width:v.width,height:v.height}),v.autoLoad=void 0!==a.autoLoad?a.autoLoad:!0,v.autoStart=void 0!==a.autoStart?a.autoStart:!0,v.state="",d=a.canvas,r=d?1:void 0!==a.maxLayers?a.maxLayers:10,v.pause=function(){x||(x=!0,v.speaker&&(t=v.speaker.isMuted(),v.speaker.mute(),v.speaker.pause(),v.dispatchEvent("pause")))},v.resize=function(){X()},v.unpause=function(){x&&(x=!1,h=+new Date,v.speaker&&(t||v.speaker.unmute(),v.speaker.unpause(),v.dispatchEvent("unpause")))},v.update=function(){v.stage.update()},v.render=function(a){v.stage.render(a)},v.clearLayers=function(){var a;for(a=0;a<v.layers.length;a+=1)v.layers[a].clear()},v.getLayer=function(a){var b,c,e;if(void 0===a&&(a=0),"number"==typeof a)e=a,e>v.layers.length-1?e>r-1?(c=v.layers[v.layers.length-1],d||BLOCKS.warn("Layer index larger than maximum layers, using the top layer instead.")):c=v.addLayer("FrameworkGameLayer"+e):c=v.layers[e];else for(b=0;b<v.layers.length;b+=1)(v.layers[b].name===a||v.layers[b].id===a)&&(c=v.layers[b]);return c},v.createLayer=function(a,b){return b=b||{},b.name=a,b.id=(+new Date).toString()+A,b.canvas=d,v.element||(b.scale=v.pixelMultiplier/v.scale),e&&(b.parentElement=e),b.width||(b.width=v.camera.width),b.height||(b.height=v.camera.height),BLOCKS.layer(b)},v.addLayer=function(a,b){var c;return d&&v.layers.length?v.getLayer():(c=v.createLayer(a,b),v.layers.push(c),c)},v.destroyLayer=function(a){a&&(a.destroy(),a=null)},v.removeLayer=function(a){var b;for(b=0;b<v.layers.length;b+=1)if(v.layers[b].name===a)return v.destroyLayer(v.layers[b]),v.layers.splice(b,1),!0},v.addMotor=function(a){var b,c=arguments[1]||{};return c.type=a,"drag"===c.type?c.controller=v.controller:c.clock=v,b=BLOCKS.motor(c),b&&(b.type=a,c.object&&c.object.motorize&&c.object.motorize(b),b.addEventListener("destroyed",v.removeMotor),y.push(b)),b},v.removeMotor=function(a){var b;for(b=0;b<y.length;b+=1)if(y[b]===a)return y.splice(b,1),!0},v.addTicker=function(a,b,c){var d=(+new Date).toString()+A;return A+=1,A>99999999&&(A=0),z.push({id:d,curTick:0,totalTicks:Math.ceil(60*b/1e3),callback:a,parameters:c}),d},v.removeTicker=function(a){var b,c=[];for(b=0;b<z.length;b+=1)z[b].id===a?z[b]=null:c.push(z[b]);z=c},v.clearTickers=function(){z=[]},v.load=function(){u||(u=!0,v.imageLoader.loadFromTree(a),v.speaker.createSoundsFromTree(a),v.imageLoader.addEventListener("update",function(){var a=v.imageLoader.getNumFilesLoaded()+v.speaker.getNumFilesLoaded();v.loadingScreen&&v.loadingScreen.setProgress(a,v.imageLoader.getNumFiles()+v.speaker.getNumFiles())}),v.imageLoader.addEventListener("complete",W),v.imageLoader.load())},v.exit=function(){v.dispatchEvent("exit")},v.stop=function(){w.removeEventListener("tick",I),w.stop()},v.start=function(){h=+new Date,i=0,s||(s=!0,v.loadingScreen&&(v.loadingScreen.destroy(),v.loadingScreen=null),v.prepare&&v.prepare()),w.removeEventListener("tick",I),w.addEventListener("tick",I),w.start()},v.destroy=function(){var a;for(w.destroy(),v.speaker&&v.speaker.destroy(),v.introScreen&&v.introScreen.destroy(),v.loadingScreen&&v.loadingScreen.destroy(),a=0;a<v.layers;a+=1)v.removeLayer(v.layers[a])},function(){for(var a=0,b=["webkit","moz"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){window.clearTimeout(a)})}(),F(),v.localization=BLOCKS.localization(),v.imageLoader=a&&a.imagesPath?BLOCKS.preloader(a.imagesPath):BLOCKS.preloader(),a&&a.loading&&(v.loadingScreen=BLOCKS.loadingScreen(a.loading,v),v.intro="loading"),a&&a.intro&&(v.introScreen=BLOCKS.introScreen(a.intro,v),v.intro="intro"),v.speaker=a.audioPlayer?a.audioPlayer:BLOCKS.speaker({path:a&&void 0!==a.audioPath?a.audioPath:"",src:a&&void 0!==a.audioSpriteSrc?a.audioSpriteSrc:"",audioPlayerType:a.audioPlayerType}),v.speaker.addEventListener("update",function(){var a=v.imageLoader.getNumFilesLoaded()+v.speaker.getNumFilesLoaded();v.loadingScreen&&v.loadingScreen.setProgress(a,v.imageLoader.getNumFiles()+v.speaker.getNumFiles())}),v.speaker.addEventListener("ready",W),Object.defineProperty(v,"paused",{get:function(){return x}}),v.loadingScreen&&v.loadingScreen.addEventListener("loaded",Z),v.introScreen&&v.introScreen.addEventListener("loaded",Z),Z(),Object.defineProperty(v,"loaded",{get:function(){return q}}),Object.defineProperty(v,"language",{get:function(){return v.localization.language},set:function(a){v.localization.language=a}}),v};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.gear=function(){"use strict";var a=BLOCKS.eventDispatcher(),b=[],c=function(a){var d;for(a.removeEventListener("destroyed",c),d=0;d<b.length;d+=1){b[d]===a&&b.splice(d,1);break}};return a.motorize=function(a){a.addEventListener("destroyed",c),b.push(a)},a.removeMotors=function(a){var c,d=[],e=[];for(c=0;c<b.length;c+=1)a?b[c].type===a?b[c].destroy():e.push(b[c]):d.push(b[c]);for(c=0;c<d.length;c+=1)d[c].destroy();b=e},a.destroy=function(){a&&(a.removeMotors(),a.dispatchEvent("destroyed",a),a=null)},a},BLOCKS.introScreen=function(a,b){"use strict";var c,d,e,f,g,h,i=BLOCKS.eventDispatcher(),j=function(){void 0===g&&e&&(g=BLOCKS.slice({layer:e,image:a.button.image,centerRegistrationPoint:!0}),g.x=a.button.x,g.y=a.button.y,b.controller.addEventListener("mouseMove",t))},k=function(){a.bg.image=b.imageLoader.loadNow(a.bg),a.bg.image.onload=l},l=function(){f||(0!==a.bg.image.width&&0!==a.bg.image.height?(q(),(g||!a.button)&&(i.loaded=!0,i.dispatchEvent("loaded"))):f||window.setTimeout(l,10))},m=function(){a.button&&(a.button.image=b.imageLoader.loadNow(a.button),a.button.image.onload=n)},n=function(){f||(0!==a.button.image.width&&0!==a.button.image.height?(h=!0,void 0===g&&j(),c&&!f&&(i.loaded=!0,i.dispatchEvent("loaded"))):f||window.setTimeout(n,10))},o=function(){e=b.addLayer("intro",{zIndex:1}),k(),m()},p=function(){r(),s()},q=function(){f||(c=BLOCKS.slice({layer:e,image:a.bg.image}),h&&j(),d=BLOCKS.clock(),d.addEventListener("tick",p),d.start())},r=function(){c.update(),g&&g.update()},s=function(){(e.dirty||g&&g.dirty)&&(c.dirty=!0,g&&(g.dirty=!0)),c.render(b),g&&g.render(b)},t=function(a){g.scale=g.isPointInside(a)?1.1:1};return i.destroy=function(){f=!0,d&&d.destroy(),c&&c.destroy(),g&&(g.destroy(),b.controller.removeEventListener("mouseMove",t)),e&&b.removeLayer("intro"),i=null},o(),i};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.layer=function(a){"use strict";var b,c,d={},e=a&&a.width||300,f=a&&a.height||150,g=a&&void 0!==a.zIndex?a.zIndex:0;return d.name=a&&a.name,d.id=a&&a.id,d.x=a&&a.x,d.y=a&&a.y,d.scale=a&&a.scale||1,d.clear=function(){b.width=b.width,d.dirty=!1},d.destroy=function(){c&&c.removeChild(b),b=null,d.ctx=null,c=null,d=null},Object.defineProperty(d,"width",{get:function(){return e},set:function(a){a!==e&&(d.dirty=!0,e=a,b.width=e)}}),Object.defineProperty(d,"height",{get:function(){return f},set:function(a){a!==f&&(d.dirty=!0,f=a,b.height=f)}}),Object.defineProperty(d,"canvasElement",{get:function(){return b}}),Object.defineProperty(d,"parentElement",{get:function(){return c}}),a||(a={}),function(){var h,i,j;if(a.canvas)b=a.canvas;else if(b=document.createElement("canvas"),b.width=e,b.height=f,b.className="BlocksCanvas",b.style.zIndex=g,d.name&&(b.id="BlocksCanvas_"+d.name),a.parentElement){for(c=a.parentElement,i=c.children,h=0;h<i.length;h+=1)if(i[h].style.zIndex>g){j=!0,c.insertBefore(b,i[h]);break}j||c.appendChild(b)}d.ctx=b.getContext("2d")}(),d},BLOCKS.loadingScreen=function(a,b){"use strict";var c,d,e,f,g,h,i,j=BLOCKS.eventDispatcher(),k=0,l="Arial,sans",m="24px",n="bold",o="#eee",p=0,q=0,r="loading... ",s=function(){a.animation&&(a.bg.image=b.imageLoader.loadNow(a.animation),a.bg.image.onload=t)},t=function(){i||(0!==a.bg.image.width&&0!==a.bg.image.height?(B(),f&&(j.loaded=!0,j.dispatchEvent("loaded"))):i||window.setTimeout(v,10))},u=function(){a.bg&&(a.bg.image=b.imageLoader.loadNow(a.bg),a.bg.image.onload=v)},v=function(){i||(0!==a.bg.image.width&&0!==a.bg.image.height?(B(),f&&(j.loaded=!0,j.dispatchEvent("loaded"))):i||window.setTimeout(v,10))},w=function(){a.progressBar&&(a.progressBar.image=b.imageLoader.loadNow(a.progressBar),a.progressBar.image.onload=x)},x=function(){i||(0!==a.progressBar.image.width&&0!==a.progressBar.image.height?(h=!0,e&&e.loading&&z(),d&&(j.loaded=!0,j.dispatchEvent("loaded"))):i||window.setTimeout(x,10))},y=function(){g||(a.animation.layer=e.loading,g=BLOCKS.slice(a.animation),g.x=a.animation.x,g.y=a.animation.y,j.dirty=!0)},z=function(){f||(a.progressBar.layer=e.loading,f=BLOCKS.slice(a.progressBar),f.x=a.progressBar.x,f.y=a.progressBar.y,j.dirty=!0)},A=function(){e={loadingBg:b.addLayer("loadingBg",{enableWebGL:!1}),loading:b.addLayer("loading")},u(),w(),s()},B=function(){i||(d=BLOCKS.slice({layer:e.loadingBg,image:a.bg.image}),h&&!f&&z(),a.animation&&!g&&y(),c=BLOCKS.clock(),c.addEventListener("tick",function(){C(),D()}),c.start(),j.dirty=!0)},C=function(){d.update(),f&&f.update(),g&&g.update()},D=function(){(j.dirty||d.dirty||g&&g.dirty||f&&f.dirty)&&(e.loading.clear(),d.dirty=!0,f&&(f.cropWidth=f.width*k,f.dirty=!0),g&&(g.dirty=!0),d.render(b),e.loading.ctx.fillStyle=o,e.loading.ctx.font=n+" "+m+" "+l,e.loading.ctx.textAlign="right",e.loading.ctx.fillText(r,p,q),e.loading.ctx.textAlign="left",e.loading.ctx.fillText(Math.round(100*k,10)+"%",p,q),f&&f.render(b),g&&g.render(b)),j.dirty=!1};return j.dirty=!0,j.destroy=function(){i=!0,c&&(c.destroy(),e&&(b.removeLayer("loadingBg"),b.removeLayer("loading")),d.destroy(),d=null,f&&(f.destroy(),f=null),g&&(g.destroy(),g=null)),j=null},j.setProgress=function(a,b){var c=a/b;k!==c&&(k=c,j.dirty=!0)},a.message&&(a.message.fontFamily&&(l=a.message.fontFamily),a.message.fontSize&&(m=a.message.fontSize.toString().replace("px","")+"px"),a.message.fontWeight&&(n=a.message.fontWeight),a.message.fontColor&&(o=a.message.fontColor),a.message.x&&(p=a.message.x),a.message.y&&(q=a.message.y),a.message.text&&(r=a.message.text)),A(),j};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.localization=function(a){"use strict";var b,c,d=BLOCKS.eventDispatcher();return a||(a={}),c="english",Object.defineProperty(d,"language",{get:function(){return c&&!b?c:b?navigator.language:void 0},set:function(a){c=a}}),b=a.autoDetect||!1,Object.defineProperty(d,"autoDetect",{get:function(){return b},set:function(a){b=Boolean(a)}}),d};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.tween=function(a){"use strict";var b,c,d,e,f=BLOCKS.eventDispatcher(),g=a.property,h=a.clock,i=a.object,j=a.amount,k=60*(a.duration/1e3),l=a.callback,m=a.easing,n=a.dirtyTolerance||0,o=0,p=o;return f.tick=function(){e||(d+=1,f.dispatchEvent("tick"),c="easeIn"===m?Math.pow(d/k,4)*j:"easeOut"===m?-(Math.pow(d/k-1,4)-1)*j:"easeInOut"===m?1>d/(k/2)?Math.pow(d/(k/2),4)*j/2:-(Math.pow(d/(k/2)-2,4)-2)*j/2:"easeOutElastic"===m?(Math.pow(2,-10*d/k)*Math.sin((d/k-.075)*2*Math.PI/.3)+1)*j:o+b,i[g]+=c-o,d===k?(i.dirty=!0,f.dispatchEvent("complete",f),l&&l(),f&&f.destroy()):(o=c,Math.abs(p-o)>n&&(p=o,i.dirty=!0)))},f.destroy=function(){e||(e=!0,h&&h.removeEventListener("tick",f.tick),f.dispatchEvent("destroyed",f),f=null)},function(){return g?i?k?j?void 0===i[g]?(BLOCKS.error("Tween property does not exist on object: "+g),null):(h&&h.addEventListener("tick",f.tick),b=j/k,d=0,void 0):(0!==j&&BLOCKS.error("Amount is required for tween property: "+g),null):(BLOCKS.error("Duration is required for tween property: "+g),null):(BLOCKS.error("Object is required for tween property: "+g),null):(BLOCKS.error("Tween property parameter required"),null)}(),f},BLOCKS.motor=function(a){"use strict";var b,c=function(a){var b,c,d,e,f,g=BLOCKS.eventDispatcher(),h=!1,i=a.clock,j=a.object,k=a.callback,l=a.speed,m=a.easing,n={x:a.x||0,y:a.y||0},o={x:0,y:0},p=BLOCKS.toolbox.dist(o,n),q=BLOCKS.toolbox.angle(o,n);return g.tick=function(){var a,d;h||(g.dispatchEvent("tick"),a=BLOCKS.toolbox.dist(o,n),b+=1,j.dirty=!0,b>=c?(j.x+=a*Math.cos(q),j.y+=a*Math.sin(q),g.dispatchEvent("complete",g),k&&k(),g&&g.destroy()):("easeIn"===m?(d=Math.pow(b/c,4)*p,e=d*Math.cos(q)-o.x,f=d*Math.sin(q)-o.y):"easeOut"===m?(d=-(Math.pow(b/c-1,4)-1)*p,e=d*Math.cos(q)-o.x,f=d*Math.sin(q)-o.y):"easeInOut"===m&&(d=1>b/(c/2)?Math.pow(b/(c/2),4)*p/2:-(Math.pow(b/(c/2)-2,4)-2)*p/2,e=d*Math.cos(q)-o.x,f=d*Math.sin(q)-o.y),o.x+=e,o.y+=f,j.x+=e,j.y+=f))},g.destroy=function(){h||(h=!0,i&&i.removeEventListener("tick",g.tick),g.dispatchEvent("destroyed",g),g=null)},function(){return p?(i&&i.addEventListener("tick",g.tick),a.duration?(d=a.duration,l=p/(60*(a.duration/1e3))):d=p/l*(1e3/60),e=l*Math.cos(q),f=l*Math.sin(q),b=0,c=p/l,Object.defineProperty(g,"curOffset",{get:function(){return o}}),void 0):(g.destroy(),g=null,null)}(),g},d=function(a){var b,d,e,f=BLOCKS.eventDispatcher(),g=!1,h=a.clock,i=a.object,j=a.callback,k=a.amplitude||10,l=a.angle*Math.PI/180||0,m=a.decay||1,n=a.duration,o=4*a.amount,p=0,q=1,r={x:0,y:0},s=function(){var a,e;a=k*q*Math.cos(l),e=k*q*Math.sin(l),d=c({object:i,x:a,y:e,duration:n/(2*o),clock:h,easing:b%2?"easeOut":"easeIn",callback:function(){r.x+=a,r.y+=e,t()}}),d.addEventListener("tick",f.tick)},t=function(){p+=1,b+=1,0===p%4&&(k*=m),b>=2&&(b=0,q*=-1),d&&(d.removeEventListener("tick",f.tick),d=null),p>=o?(e=!0,f.dispatchEvent("complete",f),j&&j(),f&&f.destroy()):s()};return f.tick=function(){g||f.dispatchEvent("tick")},f.reset=function(){g||(1===b?p=-2:0===b&&(p=-1))},f.destroy=function(){g||(g=!0,d&&(r.x+=d.curOffset.x,r.y+=d.curOffset.y,d.destroy()),e||(i.x-=r.x,i.y-=r.y),f.dispatchEvent("destroyed",f),f=null)},function(){return i?n?a.amount?(b=1,s(),void 0):(BLOCKS.error("A vibrate motor will not work without an amount"),null):(BLOCKS.error("A vibrate motor will not work without a duration"),null):(BLOCKS.error("A vibrate motor will not work without an object"),null)}(),f};return"move"===a.type?b=c(a):"vibrate"===a.type?b=d(a):"drag"===a.type?b=function(a){var b,c,d,e=BLOCKS.eventDispatcher(),f=a.object,g=a.controller,h=a.bounds,i=a.horizontalOnly,j=a.verticalOnly,k=!1,l=a.snapToRegistrationPoint,m=function(b){return a.bounds&&(b.x<h.x&&(b.x=h.x),b.x>h.x+h.width&&(b.x=h.x+h.width),b.y<h.y&&(b.y=h.y),b.y>h.y+h.height&&(b.y=h.y+h.height)),b},n=function(a){a=m(a),j||(f.x=Math.round(a.x-c)),i||(f.y=Math.round(a.y-d)),f.dirty=!0},o=function(a){f.isPointInside(a)?(f.justTapped=!0,f.dirty=!0,l===!1?(c=a.x-f.x,d=a.y-f.y):(c=0,d=0),b=!0,n(a)):(f.justNotTapped=!0,f.dirty=!0)},p=function(a){f.tapPos=a,g.drag&&b&&(n(a),f.dragging||f.dispatchEvent("onDragStart",f),f.dragging=!0)},q=function(){f.justTapped&&(f.justTapped=!1,f.dirty=!0),f.justNotTapped&&(f.justNotTapped=!1,f.dirty=!0),b&&(f.justReleased=!0,f.dispatchEvent("onDragEnd",f)),f.dragging=!1,b=!1};return e.destroy=function(){k||(k=!0,g.removeEventListener("tap",o),g.removeEventListener("drag",p),g.removeEventListener("release",q),g.removeEventListener("cancel",q),e.dispatchEvent("destroyed",e),e=null)},function(){return g?(g.addEventListener("tap",o),g.addEventListener("drag",p),g.addEventListener("release",q),g.addEventListener("cancel",q),void 0):(BLOCKS.error("A drag motor will not work without a controller"),e.destroy(),!1)}(),e}(a):("rotate"===a.type?(a.angle&&(a.amount=a.angle),a.property="angle"):a.property=a.type,b=BLOCKS.tween(a)),b};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.preloader=function(a){"use strict";var b,c=BLOCKS.eventDispatcher(),d=[],e=/iPad|iPhone|iPod/.test(navigator.userAgent),f=function(){b+=1,c.dispatchEvent("update",{loaded:b,total:d.length}),b===d.length&&c.dispatchEvent("complete")},g=function(a,b){var c,d;
for(c in a)if(a.hasOwnProperty(c)&&!(a[c]instanceof HTMLElement))if(b.apply(this,[c,a]),a[c]instanceof Object&&!(a[c]instanceof Array))g(a[c],b);else if(a[c]instanceof Array)for(d=0;d<a[c].length;d+=1)g(a[c][d],b)};return c.path=a||"",c.load=function(){var a;for(b=0,a=0;a<d.length;a+=1)d[a].loadStarted||(d[a].loadStarted=!0,d[a].image.addEventListener("load",f),d[a].image.src=c.path+d[a].src)},c.loadFromTree=function(a){g(a,function(a,b){"src"===a&&c.add(b)})},c.add=function(a){var b,c;if("string"==typeof a.src&&(e||-1!==a.src.toLowerCase().indexOf("pvr")&&(a.src=a.src.slice(0,-4)+".png"),a&&a.src&&(-1!==a.src.toLowerCase().indexOf("jpg")||-1!==a.src.toLowerCase().indexOf("png")||-1!==a.src.toLowerCase().indexOf("pvr")))){for(b=0;b<d.length;b+=1)if(d[b].src===a.src)return a.image=d[b].image,d[b];return c={image:new Image,src:a.src,loadStarted:!1},a.image=c.image,void 0!==a.crossOrigin&&(a.image.crossOrigin=a.crossOrigin),d.push(c),c}},c.loadNow=function(a){var b;return b=new Image,void 0!==a.crossOrigin&&(b.crossOrigin=a.crossOrigin),b.src=c.path+a.src,b},c.getNumFiles=function(){return d.length},c.getNumFilesLoaded=function(){return b},c.isLoaded=function(){return b>=d.length},c};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.slice=function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m=BLOCKS.view(a),n=!1,o=0,p=0,q=0,r=0,s=0,t=function(){b&&(c=a.frameWidth?a.frameWidth:b.image.width/m.numberOfColumns,d=a.frameHeight?a.frameHeight:b.image.height/m.numberOfRows,m.width=c,m.height=d)},u=function(a){a.sourceWidth>c&&(a.sourceWidth=c),a.sourceHeight>d&&(a.sourceHeight=d),a.destWidth>m.width/m.layer.scale&&(a.destWidth=m.width/m.layer.scale),a.destHeight>m.height/m.layer.scale&&(a.destHeight=m.height/m.layer.scale),a.ctx.drawImage(a.image,a.sourceX,a.sourceY,a.sourceWidth,a.sourceHeight,a.destX,a.destY,a.destWidth,a.destHeight)};return m.loop=a&&a.loop,m.variableFrameDelay=a&&void 0!==a.variableFrameDelay?a.variableFrameDelay:{},m.frameDelay=a&&void 0!==a.frameDelay?a.frameDelay:4,m.numberOfFrames=a&&a.numberOfFrames||1,m.numberOfRows=a&&a.numberOfRows||1,m.numberOfColumns=a&&a.numberOfColumns?a.numberOfColumns:m.numberOfFrames,m.autoPlay=a&&void 0!==a.autoPlay?a.autoPlay:!0,m.resetOnComplete=a&&void 0!==a.resetOnComplete?a.resetOnComplete:!0,m.update=function(){e||b&&m.numberOfFrames>1&&(o+=1,s>=m.numberOfFrames-1?o>=(m.variableFrameDelay[s]||m.frameDelay)&&(o=0,p+=1,m.loop===!0||"number"==typeof m.loop&&p<m.loop?(s=0,q=0,r=0,m.dirty=!0):(m.resetOnComplete&&(s=0,q=0,r=0,m.dirty=!0),e=!0,function(){var a;m.callback&&(a=m.callback,m.callback=null),m.dispatchEvent("complete"),a&&a()}())):o>=(m.variableFrameDelay[s]||m.frameDelay)&&(s+=1,m.numberOfColumns>1&&(s-q*m.numberOfColumns===m.numberOfColumns?(r=0,q+=1):r+=1),o=0,m.dirty=!0))},m.pause=function(){e=!0},m.unpause=function(){e=!1},m.reset=function(){m.callback=null,(0!==o||0!==s||0!==p)&&(m.dirty=!0),o=0,s=0,p=0,q=0,r=0},m.stop=function(){e=!0,m.reset()},m.play=function(a){s>=m.numberOfFrames-1&&m.stop(),e=!1,m.callback=a},m.render=function(a){var e,g,h,i,j,k,l,o;if(m.alpha<0?m.alpha=0:m.alpha>1&&(m.alpha=1),m.dirty&&m.visible&&0!==m.alpha&&0!==m.cropWidth&&0!==m.cropHeight&&0!==m.scaleX&&0!==m.scaleY&&(k={x:a&&a.camera&&a.camera.offsetX||0,y:a&&a.camera&&a.camera.offsetY||0},l=m.worldX,o=m.worldY,b&&(m.layer&&(j=m.layer.ctx,(m.angle||1!==m.alpha||m.colorize||m.mirrorX||m.mirrorY)&&(j.save(),i=!0),j.globalAlpha=m.alpha,m.angle&&(j.translate((l-k.x)/m.layer.scale,(o-k.y)/m.layer.scale),j.rotate(m.angle*Math.PI/180),j.translate((-l+k.x)/m.layer.scale,(-o+k.y)/m.layer.scale)),(m.mirrorX||m.mirrorY)&&(j.translate(l-k.x,o-k.y),m.mirrorX&&m.mirrorY?j.scale(-1,-1):m.mirrorX?j.scale(-1,1):j.scale(1,-1),j.translate(-l+k.x,-o+k.y)),m.colorize&&(f||(f=document.createElement("canvas").getContext("2d"),f.canvas.width=j.canvas.width,f.canvas.height=j.canvas.height),j=f,j.globalCompositeOperation="copy"),m.numberOfFrames>1?u({ctx:j,image:b.image,sourceX:r*m.width/m.scaleX+m.frameOffsetX,sourceY:q*m.height/m.scaleY+m.frameOffsetY,sourceWidth:m.cropWidth||c,sourceHeight:m.cropHeight||d,destX:(l+m.offsetX-k.x)/m.layer.scale,destY:(o+m.offsetY-k.y)/m.layer.scale,destWidth:(m.cropWidth*m.scaleX||m.width)/m.layer.scale,destHeight:(m.cropHeight*m.scaleY||m.height)/m.layer.scale}):u({ctx:j,image:b.image,sourceX:m.frameOffsetX,sourceY:m.frameOffsetY,sourceWidth:m.cropWidth||c,sourceHeight:m.cropHeight||d,destX:(l+m.offsetX-k.x)/m.layer.scale,destY:(o+m.offsetY-k.y)/m.layer.scale,destWidth:(m.cropWidth*m.scaleX||m.width)/m.layer.scale,destHeight:(m.cropHeight*m.scaleY||m.height)/m.layer.scale}),m.colorize&&(j.fillStyle=m.colorize,j.globalCompositeOperation="source-in",j.fillRect(l,o,m.width,m.height),j=m.layer.ctx,j.drawImage(f.canvas,0,0)),i&&j.restore()),n&&j))){for(g=m.getBounds(),g.length||(g=[g]),j.lineWidth=4,e=0;e<g.length;e+=1)m.dragging?(j.beginPath(),j.fillStyle="rgba(10, 255, 50, 0.4)",j.fillRect((g[e].x-k.x)/m.layer.scale,(g[e].y-k.y)/m.layer.scale,g[e].width/m.layer.scale,g[e].height/m.layer.scale),j.closePath()):m.justTapped?(j.beginPath(),j.fillStyle="rgba(255, 10, 50, 0.4)",j.fillRect((g[e].x-k.x)/m.layer.scale,(g[e].y-k.y)/m.layer.scale,g[e].width/m.layer.scale,g[e].height/m.layer.scale),j.closePath()):m.justNotTapped?(j.beginPath(),j.fillStyle="rgba(255, 10, 255, 0.4)",j.fillRect((g[e].x-k.x)/m.layer.scale,(g[e].y-k.y)/m.layer.scale,g[e].width/m.layer.scale,g[e].height/m.layer.scale),j.closePath()):m.justReleased&&(j.beginPath(),j.fillStyle="rgba(125, 10, 255, 0.4)",j.fillRect((g[e].x-k.x)/m.layer.scale,(g[e].y-k.y)/m.layer.scale,g[e].width/m.layer.scale,g[e].height/m.layer.scale),j.closePath(),m.justReleased=!1),j.beginPath(),j.strokeStyle="rgba(96, 255, 0, 0.5)",j.strokeRect((g[e].x-k.x)/m.layer.scale,(g[e].y-k.y)/m.layer.scale,g[e].width/m.layer.scale,g[e].height/m.layer.scale),j.closePath();j.beginPath(),j.arc((l-k.x)/m.layer.scale,(o-k.y)/m.layer.scale,7,0,2*Math.PI,!1),j.fillStyle="rgba(96, 255, 0, 0.5)",j.fill(),h=m.getBoundingBox(),(h.x!==g[0].x||h.y!==g[0].y||h.width!==g[0].width||h.height!==g[0].height)&&(j.beginPath(),j.strokeStyle="rgba(244, 246, 0, 0.5)",j.strokeRect((h.x-k.x)/m.layer.scale,(h.y-k.y)/m.layer.scale,h.width/m.layer.scale,h.height/m.layer.scale),j.closePath())}m.dirty=!1},m.gotoLastFrame=function(){s!==m.numberOfFrames-1&&(s=m.numberOfFrames-1,q=m.numberOfRows,r=m.numberOfColumns,m.dirty=!0)},m.gotoFrame=function(a){var b=Math.floor(m.frameDelay*(a-Math.floor(a))/100);a=Math.floor(a),(s!==a||o!==b)&&(s=a,q=Math.floor(s/m.numberOfColumns),r=s-q*m.numberOfColumns,o=b,m.dirty=!0)},m.destroy=function(c){var d;m&&(m.removeMotors(),m.dispatchEvent("destroyed",m)),b&&b.image&&c&&c.resetSrc&&(d=b.image.src,b.image.src=null,b.image.src=d),b=null,a=null,m=null,a=null},a=a||{},Object.defineProperty(m,"currentFrameIndex",{get:function(){return s},set:function(a){m.gotoFrame(a)}}),g=a.cropWidth,Object.defineProperty(m,"cropWidth",{get:function(){return g},set:function(a){g!==a&&(m.dirty=!0,g=a)}}),h=a.cropHeight,Object.defineProperty(m,"cropHeight",{get:function(){return h},set:function(a){h!==a&&(m.dirty=!0,h=a)}}),i=a.frameOffsetX||0,Object.defineProperty(m,"frameOffsetX",{get:function(){return i},set:function(a){i!==a&&(m.dirty=!0,i=a)}}),j=a.frameOffsetY||0,Object.defineProperty(m,"frameOffsetY",{get:function(){return j},set:function(a){j!==a&&(m.dirty=!0,j=a)}}),k=a.mirrorX,Object.defineProperty(m,"mirrorX",{get:function(){return k},set:function(a){k!==a&&(m.dirty=!0,k=a)}}),l=a.mirrorY,Object.defineProperty(m,"mirrorY",{get:function(){return l},set:function(a){l!==a&&(m.dirty=!0,l=a)}}),function(){var c=a.image,d=a.imageSrc||a.image&&a.src,f=c?!0:!1;a=a||{},m.autoPlay||(e=!0),c||d?(b={image:c,imageSrc:d,loaded:f},b.loaded?t():(b.image||(b.image=new Image),b.image.addEventListener("load",t),b.image.src=b.imageSrc)):t()}(),m};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.audio={},BLOCKS.audio.soundInstance=function(a){"use strict";var b={};return b.stop=a.stopSoundInstance(b),b.play=a.playSoundInstance(b),b.getSoundGain=a.getSoundInstanceGain(),b},BLOCKS.audio.audioElementPlayer=function(a){"use strict";var b,c,d,e,f,g,h,i,j=BLOCKS.eventDispatcher(),k=!1,l=!1,m={},n=!1,o=!1,p=function(){l||(l=!0,j.debug&&BLOCKS.debug("audio ready"),j.dispatchEvent("ready"))},q=function(){o||(o=!0,j.createSound({name:"BlocksTestSound",start:0,end:.5}),w("BlocksTestSound",p),window.setTimeout(function(){l||(w("BlocksTestSound",p),window.setTimeout(function(){l||p()},1e4))},1e4))},r=function(){j.debug&&BLOCKS.debug("onCanPlayThrough"),q()},s=function(){e&&(j.debug&&BLOCKS.debug("load audio sprite: "+b),f&&window.clearInterval(f),f=window.setInterval(function(){var a,b;e.buffered.length&&(a=e.buffered.end(e.buffered.length-1),b=100*(a/e.duration),isNaN(b)||d===b||(d=b,j.dispatchEvent("loadUpdate"),j.debug&&BLOCKS.debug("loadUpdate: "+Math.round(b)+"%"),i||(i=!0,e.pause())),window.Math.abs(a-e.duration)<.1&&(window.clearInterval(f),q(),j.dispatchEvent("loadComplete"),j.debug&&BLOCKS.debug("loadComplete")))},100),e.src=b,e.play())},t=function(){window.clearInterval(g),g=null,e.pause()},u=function(){t(),c=null},v=function(){var a,b;c?(e.currentTime>=c.end||e.currentTime>=e.duration)&&(c.loop===!0?(e.currentTime>=e.duration&&(b=!0),e.currentTime=c.start,b&&e.play()):(t(),j.dispatchEvent("played"),a=c,c=null,a.callback&&a.callback(a.name))):window.clearInterval(g)},w=function(a,b){return j.debug&&BLOCKS.debug("Play sound: "+a+" ("+m[a].start+" - "+m[a].end+")"),m[a].end>=e.duration&&(BLOCKS.warn("Sound ('"+m[a].name+"') end time is larger than sprite duration. Setting end time to the sprite duration."),m[a].end=e.duration-1e-4),m[a].start>=0&&m[a].end>0?(h>=0&&(e.volume=h,h=null),c={name:m[a].name,start:m[a].start,end:m[a].end,loop:m[a].loop,sound:m[a].sound,callback:b},e.currentTime=m[a].start,e.play(),g&&window.clearInterval(g),g=window.setInterval(v,100),!0):(BLOCKS.warn("Sound parameters not specified."),!1)},x=function(){e.pause()},y=function(){c&&e.play()},z=function(){e.volume=0},A=function(){e.volume=1};return j.setSoundGain=function(a,b){c&&c.name===a&&(h=e.volume,e.volume=b)},j.play=function(a,b){return m[a]?w(a,b):(BLOCKS.warn("Cannot play sound '"+a+"' because it was not defined"),void 0)},j.pause=function(){x()},j.unpause=function(){y()},j.stop=function(){u()},j.mute=function(){n||z(),n=!0},j.unmute=function(){n&&A(),n=!1},j.isMuted=function(){return n},j.isReady=function(){return l},j.load=function(){k||(k=!0,s())},j.createSound=function(a){void 0!==a.startTime&&void 0===a.start&&(a.start=a.startTime),void 0!==a.endTime&&void 0===a.end&&(a.end=a.endTime),void 0!==a.duration&&void 0===a.end&&(a.end=a.start+a.duration),a.end>e.duration&&(BLOCKS.warn("Sound ('"+a.name+"') end time is larger than sprite duration. Setting end time to the sprite duration."),a.end=e.duration-1e-4),m[a.name]={name:a.name,start:a.start,end:a.end,loop:a.loop}},j.getActiveSounds=function(){return[c]},j.getNumFiles=function(){return 1},j.getNumFilesLoaded=function(){return l?1:0},j.destroy=function(){e=null},function(){a&&a.src?(b=a.path?a.path:"",b+=a.src,e=document.createElement("audio"),e.addEventListener("canplaythrough",r),e.canPlayType("audio/mpeg")?b+=".mp3":e.canPlayType("audio/ogg")&&(b+=".ogg")):BLOCKS.error("sprite filename not specified")}(),j},BLOCKS.audio.webAudioPlayer=function(a){"use strict";var b,c,d,e,f=BLOCKS.eventDispatcher(),g=!1,h=!1,i=!1,j=a&&a.path||"",k={},l={},m=[],n={},o=a.maxLoadTime||6e4,p=0,q=5,r=function(a){return n[a]||(n[a]={name:a,gain:d.createGain?d.createGain():d.createGainNode()},n[a].gain.connect(c)),n[a]},s=function(){var a,b;a=f.getNumFilesLoaded(),b=f.getNumFiles(),f.debug&&BLOCKS.debug("load: "+a+" of "+b),f.dispatchEvent("update",a,b),a===b&&(h||(h=!0,window.clearTimeout(e),f.debug&&BLOCKS.debug("audio ready"),f.dispatchEvent("ready")))},t=function(a){a.request=new window.XMLHttpRequest,"withCredentials"in a.request||(a.request=new window.XDomainRequest),a.request.open("get",j+a.src+b,!0),a.request.responseType="arraybuffer",a.request.onload=function(){d.decodeAudioData(a.request.response,function(b){a.buffer=b,a.loaded=!0,s(a),a.request=null},function(){BLOCKS.debug&&BLOCKS.debug("Error decoding buffer: "+j+a.src+b),a.request=null})},a.request.send()},u=function(){var a;d&&(g=!0,a=d.createOscillator(),a.start?a.start(0,0,1):a.noteGrainOn&&a.noteGrainOn(0,0,1))},v=function(a){var b,c;for(b=0;b<m.length;b+=1)if(m[b]===a){m[b]=null,c=b;break}m.splice(c,1)},w=function(a){var b,c;f.debug&&BLOCKS.debug("Sound '"+a.sound.name+"' Complete"),a.callback&&(b=a.callback,c=a.name),v(a),b&&b(c)},x=function(a){window.clearTimeout(a.timeout),a.source.stop?a.source.stop(0):a.source.noteGrainOff?a.source.noteGrainOff(0):a.source.noteOff(0),v(a)},y=function(a){return a.gain.gain.value},z=function(a,b,e){a.gain===a.track.gain&&(a.source.disconnect(0),a.gain=d.createGain?d.createGain():d.createGainNode(),a.gain.connect(c),a.source.connect(a.gain)),f.debug&&BLOCKS.debug("speaker.setSoundGain of sound '"+a.name+"' to '"+b+"'"),e?(a.gain.gain.linearRampToValueAtTime(a.gain.gain.value,d.currentTime),a.gain.gain.linearRampToValueAtTime(b,d.currentTime+e)):a.gain.gain.value=b},A=function(a){window.clearTimeout(a.timeout),a.currentTime=(+new Date-a.startTime)/1e3%a.source.buffer.duration,a.source.stop?a.source.stop(0):a.source.noteGrainOff?a.source.noteGrainOff(0):a.source.noteOff(0)},B=function(a){var b;b=C(a.name,a.callback,a.track.name,a.currentTime),1!==a.gain.gain.value&&z(b,a.gain.gain.value),v(a)},C=function(a,c,e,g,h){var i={};return k[a].file.loaded?(m.push(i),i.sound=k[a],i.name=a,i.currentTime=g?g:0,i.startTime=+new Date-1e3*i.currentTime,h?i.delay=d.currentTime+h:(h=0,i.delay=0),e?(n[e]||r(e),i.track=n[e]):i.track=n["default"],i.source=d.createBufferSource(),i.source.buffer=k[a].file.buffer,i.source.loop=k[a].loop,i.gain=i.track.gain,i.source.connect(i.gain),k[a].loop||(i.timeout=window.setTimeout(w,1e3*(h+i.source.buffer.duration-i.currentTime),i),i.callback=c),f.debug&&(i.currentTime?BLOCKS.debug("Play sound: "+a+" ("+i.currentTime+" - "+k[a].end+"), src: "+k[a].file.src+b):BLOCKS.debug("Play sound: "+a+" ("+k[a].start+" - "+k[a].end+"), src: "+k[a].file.src+b)),i.source.start?i.currentTime?i.source.start(i.delay,i.currentTime):i.source.start(i.delay):i.source.noteGrainOn&&i.source.noteGrainOn(i.delay,i.currentTime,i.source.buffer.duration-i.currentTime),i):(BLOCKS.warn("Tried to play sound: "+a+", but it is not loaded yet"),void 0)},D=function(){e=window.setTimeout(function(){var a;for(a in l)l.hasOwnProperty(a)&&(l[a].loaded||(l[a].request?(BLOCKS.warn("Sound file load has timed out. Aborting request and trying again: "+l[a].src),l[a].request.abort()):BLOCKS.warn("Sound file load has timed out. Sending additional request: "+l[a].src),t(l[a])));p+=1,q>p&&D()},o)};return f.play=function(a,b,c,d,e){return k[a]?C(a,b,c,d,e):(BLOCKS.warn("Cannot play sound '"+a+"' because it was not defined"),void 0)},f.getSoundDuration=function(a){return k[a].file.buffer.duration},f.getSoundInstanceGain=function(a){return y(a)},f.getSoundGain=function(a){var b,c=m.slice(0);for(b=0;b<c.length;b+=1)if(c[b].name===a)return y(c[b])},f.setSoundInstanceGain=function(a,b,c){z(a,b,c)},f.setSoundGain=function(a,b,c){var d,e=m.slice(0);for(d=0;d<e.length;d+=1)e[d].name===a&&z(e[d],b,c)},f.stopSound=function(a){var b,c=m.slice(0);for(b=0;b<c.length;b+=1)c[b].name===a&&x(c[b])},f.pauseSound=function(a){var b,c=m.slice(0);for(b=0;b<c.length;b+=1)c[b].name===a&&A(c[b])},f.unpauseSound=function(a){var b,c=m.slice(0);for(b=0;b<c.length;b+=1)c[b].name===a&&B(c[b])},f.stopTrack=function(a){var b,c=m.slice(0);for(b=0;b<c.length;b+=1)c[b].track.name===a&&x(c[b])},f.pauseTrack=function(a){var b,c=m.slice(0);for(b=0;b<c.length;b+=1)c[b].track.name===a&&A(c[b])},f.unpauseTrack=function(a){var b,c=m.slice(0);for(b=0;b<c.length;b+=1)c[b].track.name===a&&B(c[b])},f.stop=function(){var a,b=m.slice(0);for(a=0;a<b.length;a+=1)x(b[a])},f.pause=function(){var a,b=m.slice(0);for(a=0;a<b.length;a+=1)A(b[a])},f.unpause=function(){var a,b=m.slice(0);for(a=0;a<b.length;a+=1)B(b[a])},f.mute=function(){i||(i=!0,c.gain.value=0)},f.unmute=function(){i&&(i=!1,c.gain.value=1)},f.isMuted=function(){return i},f.load=function(){g||(g=!0,D(),u())},f.isReady=function(){return h},f.createSound=function(a){var b;if("string"==typeof a.src)b=a.src;else{if(!a.language)return BLOCKS.warn("Sound ('"+a.name+"') src property is not valid."),void 0;if(a.src[a.language])b=a.src[a.language];else{if(!a.src.english)return BLOCKS.warn("Sound ('"+a.name+"') does not have a translation for requested language ("+a.language+")."),void 0;BLOCKS.warn("Sound ('"+a.name+"') does not have a translation for requested language ("+a.language+"). Using English version."),b=a.src.english}}k[a.name]={name:a.name,start:a.start,end:a.end,loop:a.loop,src:b},l[b]?a.preload!==!1&&l[b].preload===!1&&(l[b].preload=!0,h=!1,t(l[b])):(l[b]={src:b,preload:Boolean(a.preload!==!1)},a.preload!==!1&&(h=!1,t(l[b]))),k[a.name].file=l[b]},f.getActiveSoundInstances=function(){return m},f.getNumFiles=function(){var a,b;b=0;for(a in l)l.hasOwnProperty(a)&&l[a].preload!==!1&&(b+=1);return b},f.getNumFilesLoaded=function(){var a,b;b=0;for(a in l)l.hasOwnProperty(a)&&l[a].loaded&&(b+=1);return b},f.getCurrentTime=function(){return d.currentTime},f.destroy=function(){f.stop(),d&&d.close&&d.close(),d=null},f.multipleTracksSupported=!0,function(){var a,e=document.createElement("audio");a=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,b=e.canPlayType("audio/mpeg;").replace(/no/,"")&&e.canPlayType&&!a?".mp3":".ogg","undefined"!=typeof AudioContext?d=new window.AudioContext:"undefined"!=typeof webkitAudioContext&&(d=new window.webkitAudioContext),d?(c=d.createGain?d.createGain():d.createGainNode(),c.connect(d.destination)):BLOCKS.error("Cannot create audio context."),r("default")}(),f},BLOCKS.audio.multiAudioElementPlayer=function(a){"use strict";var b,c,d,e=BLOCKS.eventDispatcher(),f=!1,g=!1,h=!1,i=a&&a.path||"",j={},k={},l=[],m={},n=a.maxLoadTime||6e4,o=0,p=5,q=function(a){return m[a]||(m[a]={name:a,gain:c.createGain?c.createGain():c.createGainNode()},m[a].gain.connect(b)),m[a]},r=function(){var a,b;a=e.getNumFilesLoaded(),b=e.getNumFiles(),e.debug&&BLOCKS.debug("load: "+a+" of "+b),e.dispatchEvent("update",a,b),a===b&&(g||(g=!0,window.clearTimeout(d),e.debug&&BLOCKS.debug("audio ready"),e.dispatchEvent("ready")))},s=function(a){a.audioElement=document.createElement("audio"),a.audioElement.preload=!0,a.audioElement.src=i+a.src,a.audioElement.load(),a.audioElement.addEventListener("canplaythrough",function(){a.loaded=!0,r(a)})},t=function(){},u=function(a){var b,c;for(b=0;b<l.length;b+=1)if(l[b]===a){l[b]=null,c=b;break}l.splice(c,1)},v=function(a){a.timeout&&window.clearTimeout(a.timeout),a.fadeTimeout&&window.clearTimeout(a.fadeTimeout),a.sound.file.audioElement.pause(),u(a)},w=function(a){return a.sound.file.audioElement.volume},x=function(a,b,c){var d=10;a.fadeTimeout&&(a.sound.file.audioElement.volume=a.fadeTarget,window.clearInterval(a.fadeTimeout),a.fadeTarget=0,a.fadeAmount=0),c?(a.fadeTarget=b,a.fadeAmount=(b-a.sound.file.audioElement.volume)/(1e3*c/d),a.fadeTimeout=window.setInterval(function(){a.sound.file.audioElement.volume===a.fadeTarget&&window.clearInterval(a.fadeTimeout),a.sound.file.audioElement.volume+=a.fadeAmount},d)):a.sound.file.audioElement.volume=b},y=function(a){window.clearTimeout(a.timeout),a.currentTime=(+new Date-a.startTime)/1e3%a.sound.file.audioElement.duration,a.sound.file.audioElement.pause()},z=function(a){var b;b=A(a.name,a.callback,null,a.currentTime),u(a)},A=function(a,b,d,f,g){var h={};return j[a].file.loaded?(l.push(h),h.sound=j[a],h.name=a,h.currentTime=f?f:0,h.startTime=+new Date-1e3*h.currentTime,g?h.delay=c.currentTime+g:(g=0,h.delay=0),d?(m[d]||q(d),h.track=m[d]):h.track=m["default"],j[a].loop?h.sound.file.audioElement.loop=!0:h.callback=b,e.debug&&(h.currentTime?BLOCKS.debug("Play sound: "+a+" ("+h.currentTime+" - "+j[a].end+"), src: "+j[a].file.src):BLOCKS.debug("Play sound: "+a+" ("+j[a].start+" - "+j[a].end+"), src: "+j[a].file.src)),h.sound.file.audioElement.currentTime=h.currentTime,h.sound.file.audioElement.play(),h):(BLOCKS.warn("Tried to play sound: "+a+", but it is not loaded yet"),void 0)},B=function(){d=window.setTimeout(function(){var a;for(a in k)k.hasOwnProperty(a)&&!k[a].loaded&&k[a].preload&&(k[a].request?(BLOCKS.warn("Sound file load has timed out. Aborting request and trying again: "+k[a].src),k[a].request.abort()):BLOCKS.warn("Sound file load has timed out. Sending additional request: "+k[a].src),s(k[a]));o+=1,p>o&&B()},n)};return e.play=function(a,b,c,d,e){return j[a]?A(a,b,c,d,e):(BLOCKS.warn("Cannot play sound '"+a+"' because it was not defined"),void 0)},e.getSoundDuration=function(a){return j[a].file.buffer.duration},e.getSoundInstanceGain=function(a){return w(a)},e.getSoundGain=function(a){var b,c=l.slice(0);for(b=0;b<c.length;b+=1)if(c[b].name===a)return w(c[b])},e.setSoundInstanceGain=function(a,b,c){x(a,b,c)},e.setSoundGain=function(a,b,c){var d,e=l.slice(0);for(d=0;d<e.length;d+=1)e[d].name===a&&x(e[d],b,c)},e.stopSound=function(a){var b,c=l.slice(0);for(b=0;b<c.length;b+=1)c[b].name===a&&v(c[b])},e.pauseSound=function(a){var b,c=l.slice(0);for(b=0;b<c.length;b+=1)c[b].name===a&&y(c[b])},e.unpauseSound=function(a){var b,c=l.slice(0);for(b=0;b<c.length;b+=1)c[b].name===a&&z(c[b])},e.stopTrack=function(){},e.pauseTrack=function(){},e.unpauseTrack=function(){},e.stop=function(){var a,b=l.slice(0);for(a=0;a<b.length;a+=1)v(b[a])},e.pause=function(){var a,b=l.slice(0);for(a=0;a<b.length;a+=1)y(b[a])},e.unpause=function(){var a,b=l.slice(0);for(a=0;a<b.length;a+=1)z(b[a])},e.mute=function(){h||(h=!0)},e.unmute=function(){h&&(h=!1)},e.isMuted=function(){return h},e.load=function(){f||(f=!0,B(),t())},e.isReady=function(){return g},e.createSound=function(a){var b=document.createElement("audio");return"string"!=typeof a.src?(BLOCKS.warn("Sound ('"+a.name+"') src property is not a string."),void 0):((void 0===a.extension||"caf"===a.extension&&!b.canPlayType("audio/x-caf")||"mp4"===a.extension&&!b.canPlayType("audio/mp4"))&&(a.extension="mp3"),j[a.name]={name:a.name,start:a.start,end:a.end,loop:a.loop},k[a.src+"."+a.extension]||(k[a.src+"."+a.extension]={src:a.src+"."+a.extension},s(k[a.src+"."+a.extension])),j[a.name].file=k[a.src+"."+a.extension],void 0)},e.getActiveSoundInstances=function(){return l},e.getNumFiles=function(){var a,b;b=0;for(a in k)k.hasOwnProperty(a)&&k[a].preload!==!1&&(b+=1);return b},e.getNumFilesLoaded=function(){var a,b;b=0;for(a in k)k.hasOwnProperty(a)&&k[a].loaded&&(b+=1);return b},e.getCurrentTime=function(){return null},e.destroy=function(){var a;for(a in k)k.hasOwnProperty(a)&&k[a].audioElement&&(k[a].audioElement=null)},e.multipleTracksSupported=!0,e},BLOCKS.speaker=function(a){"use strict";var b;return function(){a||(a={}),b="multiAudioElementPlayer"===a.audioPlayerType?BLOCKS.audio.multiAudioElementPlayer(a):"audioElementPlayer"===a.audioPlayerType||"undefined"==typeof AudioContext&&"undefined"==typeof webkitAudioContext||a.webAudioEnabled===!1?BLOCKS.audio.audioElementPlayer(a):BLOCKS.audio.webAudioPlayer(a)}(),b.createSoundsFromTree=function(a,c){var d=function(a,b){var c,e;for(c in a)if(a.hasOwnProperty(c)&&!(a[c]instanceof HTMLElement))if(b.apply(this,[c,a]),a[c]instanceof Object&&!(a[c]instanceof Array))d(a[c],b);else if(a[c]instanceof Array)for(e=0;e<a[c].length;e+=1)d(a[c][e],b)};d(a,function(a,d){"src"===a&&("string"==typeof d[a]&&-1===d[a].indexOf(".")||c&&d[a].english&&-1===d[a].english.indexOf("."))&&(c&&(d.language=c),b.createSound(d))})},b.debug=!1,b};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.stack=function(a){"use strict";var b,c,d,e,f=BLOCKS.eventDispatcher(),g=[],h=[],i=function(a){var b;for(a.removeEventListener("destroyed",i),b=0;b<h.length;b+=1){h.splice(b,1);break}},j=function(a){var b;for(b=0;b<g.length;b+=1)g[b].dirty=a},k=function(){var a;for(a=0;a<g.length;a+=1)if(g[a].dirty)return!0};return a=a||{},f.addView=function(a){a.stack=f,g.push(a)},f.getView=function(a){var b;for(b=0;b<g.length;b+=1)if(g[b].name===a)return g[b]},f.removeView=function(a){var b;for(b=0;b<g.length;b+=1)if(g[b]===a){g[b].splice(b,1);break}},f.show=function(){var a;if(!e)for(e=!0,a=0;a<g.length;a+=1)g[a].show()},f.hide=function(){var a;if(e)for(e=!1,a=0;a<g.length;a+=1)g[a].hide()},f.isPointInside=function(a){var b;for(b=0;b<g.length;b+=1)if(g[b].visible&&g[b].isPointInside(a))return!0;return!1},f.motorize=function(a){a.addEventListener("destroyed",i),h.push(a)},f.removeMotors=function(a){var b,c=[];for(b=0;b<h.length;b+=1)a?h[b].type===a?h[b].destroy():c.push(h[b]):h[b].destroy();h=c},f.destroy=function(){var a;for(a=0;a<g.length;a+=1)g[a].destroy();g=[],f=null},Object.defineProperty(f,"dirty",{get:function(){return k()},set:function(a){j(a)}}),Object.defineProperty(f,"alpha",{get:function(){return void 0!==b?b:1},set:function(a){var c;for(b=a,c=0;c<g.length;c+=1)g[c].alpha=a}}),Object.defineProperty(f,"width",{get:function(){var a,b=0;for(a=0;a<g.length;a+=1)g[a].visible&&g[a].width>b&&(b=g[a].width);return b}}),Object.defineProperty(f,"height",{get:function(){var a,b=0;for(a=0;a<g.length;a+=1)g[a].visible&&g[a].height>b&&(b=g[a].height);return b}}),c=a.x||0,Object.defineProperty(f,"x",{get:function(){return c},set:function(a){c!==a&&(c=a,j(!0))}}),d=a.y||0,Object.defineProperty(f,"y",{get:function(){return d},set:function(a){d!==a&&(d=a,j(!0))}}),e=a.visible||!0,Object.defineProperty(f,"visible",{get:function(){return e},set:function(a){a?f.show():f.hide()}}),f};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.storage=function(){"use strict";var a=BLOCKS.eventDispatcher();return a.get=function(a){return window.localStorage?JSON.parse(window.localStorage.getItem(a)):null},a.save=function(a,b){window.localStorage.setItem(a,JSON.stringify(b))},a.destroy=function(){a=null},a};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.storybookPage=function(a,b){"use strict";var c,d,e,f,g=BLOCKS.gear(),h=[],i={},j=function(a,b){var c;for(f&&(f[a]=b),c=0;c<h.length;c+=1)h[c][a]=b},k=function(){var a;if(f&&f.dirty)return!0;for(a=0;a<h.length;a+=1)if(h[a].dirty)return!0;return!1};return g.x=0,g.y=0,g.scaleX=1,g.scaleY=1,g.turnRatio=1,g.destroy=function(){a=null,h=null,g=null},g.update=function(){var a;for(Math.abs(g.turnRatio)<.001&&(g.turnRatio=0),f&&(f.scaleX=f.world.scale*g.turnRatio*g.scaleX,f.scaleY=f.world.scale*g.scaleY,f.x=g.x+f.world.x*g.turnRatio*g.scaleX,f.y=g.y+f.world.y*g.scaleY,f.update()),a=0;a<h.length;a+=1)h[a].scaleX=h[a].world.scale*g.turnRatio*g.scaleX,h[a].scaleY=h[a].world.scale*g.scaleY,h[a].x=g.x+h[a].world.x*g.turnRatio*g.scaleX,h[a].y=g.y+h[a].world.y*g.scaleY,h[a].update()},g.render=function(a){var b;for(f&&f.render(a),b=0;b<h.length;b+=1)h[b].render(a)},g.startHighlighting=function(){var b;for(b=0;b<h.length;b+=1)"textarea"!==a.content[b].type&&void 0===a.content[b].text||!h[b].startHighlighting||h[b].startHighlighting()},g.stopHighlighting=function(){var b;for(b=0;b<h.length;b+=1)"textarea"!==a.content[b].type&&void 0===a.content[b].text||!h[b].startHighlighting||h[b].stopHighlighting()},g.getChildren=function(){return i},g.getChild=function(a){return i[a]},c=a.layer,Object.defineProperty(g,"layer",{get:function(){return c},set:function(a){c!==a&&(c=a,j("layer",a),j("dirty",!0))}}),e=!0,Object.defineProperty(g,"visible",{get:function(){return e},set:function(a){e!==a&&(e=a,j("visible",a))}}),d=1,Object.defineProperty(g,"alpha",{get:function(){return d},set:function(a){d!==a&&(d=a,j("alpha",a),j("dirty",!0))}}),Object.defineProperty(g,"dirty",{get:function(){return k()},set:function(a){j("dirty",a)}}),function(){var c,d,e,g=function(a){var c,d={};for(c in a)a.hasOwnProperty(c)&&(d[c]=a[c]);if(b&&a[b])for(c in a[b])a[b].hasOwnProperty(c)&&(d[c]=a[b][c]);else if(a.english)for(c in a.english)a.english.hasOwnProperty(c)&&(d[c]=a.english[c]);return d};if(a=a||{},e=g(a.background||a.bg),a.background&&(f=BLOCKS.slice(e)),f&&(f.world={x:f.x||0,y:f.y||0,scale:1},f.name?i[f.name]=f:i.background=f),a&&a.content)for(c=0;c<a.content.length;c+=1)e=g(a.content[c]),e.slices?d=BLOCKS.block(e):e.src?d=BLOCKS.slice(e):("textarea"===e.type||void 0!==e.text)&&(d=BLOCKS.textField(e)),d.start={x:d.x||0,y:d.y||0,scale:d.scale||1},d.world={x:d.start.x,y:d.start.y,scale:d.scale},d.scale=1,h.push(d),d.name&&(i[d.name]?BLOCKS.warn("Duplication children name on storybook page: "+d.name):i[d.name]=d)}(),g},BLOCKS.storybook=function(a,b,c){"use strict";var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=BLOCKS.gear(),x=!1,y=function(a){var b;for(b=0;b<o.length;b+=1)o[b].dirty=a},z=function(){var a;for(a=0;a<o.length;a+=1)if(o[a].visible&&o[a].dirty)return!0;return!1},A=function(){var a;for(a=0;a<o.length;a+=1)o[a].visible=Boolean(q||f&&!n&&(a===m||a===m-1)||n&&(a===n.curPageNum||a===n.middlePageNum||a===n.targetPageNum||a===n.prevPageNum))},B=function(a){0===a?(s&&(s.visible=!1),r&&(r.visible=Boolean("cover"===r.getSlice().name),r.setSlice("cover"))):(s&&(s.visible=!0),r&&(r.visible=Boolean("open"===r.getSlice().name),r.setSlice("open")))},C=function(a){var b;a&&a.page||BLOCKS.error("turnPage function requires a page to turn"),b="left"===a.direction||-1===a.direction?-1:1,a.page.turning=!0,v.visible=!0,a.page.motorize(BLOCKS.motor({object:a.page,type:"turnRatio",amount:b,duration:w.pageTurnDuration,clock:w,callback:function(){a.page.turning=!1,v.visible=!1,a.callback&&a.callback(),A()}})),a.page!==o[0]&&u&&(u.pageScaleY&&(a.page.scaleY=-1===b?w.scaleY:w.scaleY+b*u.pageScaleY,a.page.motorize(BLOCKS.motor({object:a.page,type:"scaleY",amount:-b*u.pageScaleY,duration:w.pageTurnDuration,clock:w}))),u.pageMoveY&&(a.page.y=-1===b?w.y:w.y-b*u.pageMoveY,a.page.motorize(BLOCKS.motor({object:a.page,type:"y",amount:b*u.pageMoveY,duration:w.pageTurnDuration,clock:w}))))},D=function(a,b){var c;v&&b.dirty&&(c=1.5*b.turnRatio,b.turnRatio<0?(v.mirrorX=!0,-1>c&&(c=-1),v.scaleX=w.scaleX*c,v.x=w.x+v.width):(v.mirrorX=!1,c>1&&(c=1),v.scaleX=w.scaleX*c,v.x=w.x),b!==t&&b.turnRatio<0&&u?(u.pageScaleY&&(v.scaleY=1+u.pageScaleY),u.pageScaleY&&(v.y=w.y-u.pageMoveY)):(v.scaleY=b.scaleY,v.y=w.y),v.dirty=!0,v.render(a))};return w.pageTurnDuration=b.book&&void 0!==b.book.pageTurnDuration?b.book.pageTurnDuration:1e3,w.update=function(){var a;for(w.dispatchEvent("tick"),a=0;a<o.length;a+=1)o[a].visible&&o[a].update();t&&t.update(),r&&r.update(),s&&s.update(),v&&v.update()},w.render=function(a){var b,c;for((z()||r&&r.dirty||s&&s.dirty||t&&t.dirty||v&&v.dirty)&&(c=!0,y(!0)),r&&c&&(r.dirty=!0,r.render(a)),b=0;b<o.length;b+=1)b%2&&o[b].visible&&(o[b].turning&&D(a,o[b]),o[b].render(a));for(b=o.length-1;b>=0;b-=1)(0===b%2||0===b)&&o[b].visible&&(o[b].turning&&D(a,o[b]),o[b].render(a));s&&c&&(s.dirty=!0,s.render(a)),t&&c&&(t.dirty=!0,t.render(a)),x&&function(){var b,c={x:a&&a.camera&&a.camera.offsetX||0,y:a&&a.camera&&a.camera.offsetY||0};b=e.ctx,b.beginPath(),b.strokeStyle="rgba(244, 244, 244, 0.5)",b.strokeRect(w.x-c.x,w.y-c.y,w.width,w.height),b.closePath()}()},w.destroy=function(){w.stopMotors(),b=null,a=null,w=null},w.back=function(){n||m-2>=0&&(n={curPageNum:m,middlePageNum:m-1,targetPageNum:m-2,prevPageNum:m-3},o[n.middlePageNum].turnRatio=-1,o[n.targetPageNum].turnRatio=0,C({page:o[n.middlePageNum],direction:"right",callback:function(){B(n.targetPageNum),C({page:o[n.targetPageNum],direction:"right",callback:function(){w.dispatchEvent("previousPageEnd",n.targetPageNum),m=n.targetPageNum,n=null}})}}),A())},w.next=function(){!n&&m+2<=o.length&&(n={prevPageNum:m-1,curPageNum:m,middlePageNum:m+1,targetPageNum:m+2},o[n.middlePageNum].turnRatio=0,C({page:o[n.curPageNum],direction:"left",callback:function(){B(n.targetPageNum),C({page:o[n.middlePageNum],direction:"left",callback:function(){w.dispatchEvent("nextPageEnd",n.targetPageNum),m=n.targetPageNum,n=null}})}}),A())},w.prevPage=function(){return d.getCurrentPageNum()>1?(d.previousPage(),!0):!1},w.nextPage=function(){return d.getCurrentPageNum()<d.getNumPages()-3?(d.nextPage(),!0):!1
},w.destroy=function(){d&&d.destroy()},w.startHighlighting=function(a){return o[void 0!==a?a:m].startHighlighting()},w.stopHighlighting=function(a){return o[void 0!==a?a:m].stopHighlighting()},w.getChildren=function(a){return o[void 0!==a?a:m].getChildren()},w.getChild=function(a,b){return o[void 0!==b?b:m].getChild(a)},Object.defineProperty(w,"numberOfPages",{get:function(){return t?o.length-1:o.length}}),Object.defineProperty(w,"targetPageNum",{get:function(){return n&&n.targetPageNum}}),Object.defineProperty(w,"curPageNum",{get:function(){return m}}),Object.defineProperty(w,"layer",{get:function(){return e},set:function(a){var b;if(e!==a){for(e=a,b=0;b<o.length;b+=1)o[b].layer=a;r&&(r.layer=a),s&&(s.layer=a),v&&(v.layer=a)}}}),f=!0,Object.defineProperty(w,"visible",{get:function(){return f},set:function(a){f!==a&&(f=a,A())}}),k=0,Object.defineProperty(w,"x",{get:function(){return k},set:function(a){var b;if(k!==a){for(k=a,b=0;b<o.length;b+=1)o[b].x=a;r&&(r.x=a),s&&(s.x=a),v&&(v.x=a)}}}),l=0,Object.defineProperty(w,"y",{get:function(){return l},set:function(a){var b;if(l!==a){for(l=a,b=0;b<o.length;b+=1)o[b].y=a;r&&(r.y=a),s&&(s.y=a),v&&(v.y=a)}}}),i=b.book&&b.book.pageWidth||1024,Object.defineProperty(w,"width",{get:function(){return i*w.scaleX}}),j=b.book&&b.book.pageHeight||768,Object.defineProperty(w,"height",{get:function(){return j*w.scaleY}}),g=1,Object.defineProperty(w,"scaleX",{get:function(){return g},set:function(a){var b;if(g!==a){for(g=a,b=0;b<o.length;b+=1)o[b].scaleX=a;r&&(r.scaleX=a),s&&(s.scaleX=a),v&&(v.scaleX=a)}}}),h=1,Object.defineProperty(w,"scaleY",{get:function(){return h},set:function(a){var b;if(h!==a){for(h=a,b=0;b<o.length;b+=1)o[b].scaleY=a;r&&(r.scaleY=a),s&&(s.scaleY=a),v&&(v.scaleY=a)}}}),Object.defineProperty(w,"dirty",{get:function(){return z()},set:function(a){y(a)}}),function(){var d,f,g;for(f=0,p=[],o=[],a.cover?(o[0]=BLOCKS.storybookPage(a.cover,c),t=o[0]):BLOCKS.error("BLOCKS storybook requires a cover property in the the storybook object"),d=0;d<a.pages.length;d+=1)g=BLOCKS.storybookPage(a.pages[d],c),g&&(q&&(g.y-=10*Math.ceil(a.pages.length/2),g.y+=f,g.alpha=.8),0===d%2?g.turnRatio=-1:q&&(f+=10)),o.push(g);u=b.book.fauxPageBending,b.book.board&&(r=BLOCKS.block(b.book.board),r.layer=e,r.x=w.x,r.y=w.y,r.scaleX=w.scaleX,r.scaleY=w.scaleY),b.book.overlay&&(s=BLOCKS.block(b.book.overlay),s.layer=e,s.x=w.x,s.y=w.y,s.scaleX=w.scaleX,s.scaleY=w.scaleY),b.book.pageShadow&&(v=BLOCKS.slice(b.book.pageShadow),v.layer=e,v.x=w.x,v.y=w.y,v.scaleX=w.scaleX,v.scaleY=w.scaleY,v.visible=!1),m=t?2*b.book.startOnSpread||0:2*b.book.startOnSpread||1,B(m),A()}(),w};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.textField=function(a){"use strict";var b,c,d,e,f,g,h=BLOCKS.view(a),i=!1,j=[],k={},l=0,m="english",n=function(a){var b;for(a.removeEventListener("destroyed",n),b=0;b<j.length;b+=1){j.splice(b,1);break}},o=function(){var a,b,c,d,e,g,h,i,j,m,n,o={fontColor:null,fontFamily:null,fontSize:null,fontItalic:null,fontWeight:null,highlight:null},p={b:"fontWeight",i:"fontItalic",hi:"highlight",newLine:"newLine"},q=function(a){return Math.floor(60*parseFloat(a))},r=function(a,b){var c,d,e,f;c=a.split("="),d=c[0],c.length>1&&(e=c[1].replace(/"/g,"").replace(/'/g,""),f=e.split(",")),p[d]&&("b"===d||"i"===d?o[p[d]]=b:"hi"===d&&(b?(i=f.length>1?q(f[0]):h,j=q(f[f.length-1]),j>l&&(l=j),o[p[d]]={start:i,end:j},h=j,k[i]=!0,k[j]=!0):o[p[d]]=!1))};for(g in f)if(f.hasOwnProperty(g))for(m=f[g].paragraphs,a=0;a<m.length;a+=1)for(m[a]={text:m[a]},b=!0,m[a].charList=[],e=0,d=0,h=0,n=!1;d<m[a].text.length;)if(/^<newline>/i.test(m[a].text.slice(d)))c=/<newline>/i.exec(m[a].text.slice(d)),d+=c[0].length,n=!0;else if(/^<\/(.*?)\>/i.test(m[a].text.slice(d)))c=/<\/(.*?)\>/i.exec(m[a].text.slice(d)),r(c[1].replace("/",""),!1),d+=c[0].length;else if(/^<(.*?)>/i.test(m[a].text.slice(d)))c=/<(.*?)>/i.exec(m[a].text.slice(d)),r(c[1],!0),d+=c[0].length;else{" "===m[a].text[d]&&(e=m[a].charList.length+2),m[a].charList.push({character:m[a].text[d],wordStartIndex:e,newParagraph:b,newline:n,style:{}});for(g in o)m[a].charList[m[a].charList.length-1].style[g]=o[g];n=!1,b=!1,d+=1}};return h.update=function(){d&&(e+=1,k[e]&&(h.dirty=!0),e>=l&&(d=!1))},h.render=function(a){var f,j,k,l,n,o,p,q,r,s,t,u,v,w=function(a){var b,i,j,k=function(c){var j,k=0;for(b=a.startIndex;b<a.endIndex;b+=1)i="",(v[f].charList[b].style.fontWeight||h.fontWeight)&&(i+=(v[f].charList[b].style.fontWeight||h.fontWeight)+" "),(v[f].charList[b].style.fontItalic||h.fontItalic)&&(i+="italic "),i+=Number(h.fontSize.toString().replace("px",""))+"px"+" "+h.fontFamily,q.font=i,c&&(a.stroke?(q.strokeStyle=h.strokeColor,q.lineWidth=h.strokeLineWidth||10,q.lineCap=h.strokeLineCap||"round",q.lineJoin=h.strokeLineJoin||"round",q.strokeText(v[f].charList[b].character,c.x+k,c.y)):(q.fillStyle=d&&v[f].charList[b].style.highlight&&e>=v[f].charList[b].style.highlight.start&&e<v[f].charList[b].style.highlight.end?h.highlightColor:h.fontColor,q.fillText(v[f].charList[b].character,c.x+k,c.y))),j=q.measureText(v[f].charList[b].character).width,k+=j,g&&(k+=.11);return k};return j=k(),a.measureOnly===!0||void 0===a.y?j:(s="center"===h.textAlign?h.x-r.x-j/2:"right"===h.textAlign?h.x-r.x+(h.width||c.width):h.x-r.x,t=a.y,h.strokeColor&&k({x:s,y:t,stroke:!0}),k({x:s,y:t}),j)};if(h.dirty&&h.visible&&0!==h.alpha&&h.layer&&0!==h.scale&&0!==h.scaleX&&0!==h.scaleY){for(r={x:a&&a.camera&&a.camera.offsetX||0,y:a&&a.camera&&a.camera.offsetY||0},c={width:a&&a.camera&&a.camera.width||300,height:a&&a.camera&&a.camera.height||150},q=h.layer.ctx,(h.angle||1!==h.alpha||1!==h.scaleX||1!==h.scaleY)&&(q.save(),l=!0),(1!==h.scaleX||1!==h.scaleY)&&(q.translate(h.x-r.x,h.y-r.y),q.scale(h.scaleX,h.scaleY),q.translate(-(h.x-r.x),-(h.y-r.y))),1!==h.alpha&&(q.globalAlpha=h.alpha),h.angle&&(q.translate(h.x-r.x,h.y-r.y),q.rotate(h.angle*Math.PI/180),q.translate(-(h.x-r.x),-(h.y-r.y))),q.textBaseline=h.textBaseline,u=0,p=h.y-r.y,b=0,m=a.language,v=h.text,f=0;f<v.length;f+=1){for(n="",o=0,j=0;j<v[f].charList.length;j+=1)if(n+=v[f].charList[j].character,(j&&h.width&&w({startIndex:o,endIndex:j,measureOnly:!0})>h.width/h.scaleX||v[f].charList[j].newline)&&(v[f].charList[j].wordStartIndex>o&&(n=n.slice(0,n.length-1-(j-v[f].charList[j].wordStartIndex)),j=v[f].charList[j].wordStartIndex-2),w({startIndex:o,endIndex:j,y:p}),n="",o=" "===v[f].charList[j].character?j+1:j,p+=h.lineHeight,b+=1),u+=1,u>1e3){BLOCKS.error("Cannot render textfield. Width maybe smaller than character.");break}w({startIndex:o,endIndex:j,y:p}),b+=1}if("alphabetic"===h.textBaseline?(h.hotspots=[{x:0,y:.7*-h.lineHeight,width:h.width/h.scaleX||c.width,height:h.lineHeight*b}],"center"===h.textAlign&&(h.hotspots[0].x=-h.hotspots[0].width/2)):(h.hotspots=[{x:0,y:0,width:h.width/h.scaleX||c.width,height:h.lineHeight*b}],"center"===h.textAlign&&(h.hotspots[0].x=-h.hotspots[0].width/2)),i)for(k=h.getBounds(),k.length||(k=[k]),h.height=k[0].height||b*h.lineHeight,q.lineWidth=4,f=0;f<k.length;f+=1)q.beginPath(),q.strokeStyle="rgba(255, 10, 255, 0.4)",q.strokeRect(k[f].x-r.x,k[f].y-r.y,k[f].width||c.width,h.height),q.closePath();l&&q.restore()}h.dirty=!1},h.destroy=function(){h.stopMotors(),h=null},h.motorize=function(a){a.addEventListener("destroyed",n),j.push(a)},h.stopMotors=function(a){var b,c=j.slice(0);for(b=0;b<c.length;b+=1)a?c[b].type===a&&c[b].destroy():c[b].destroy()},h.startHighlighting=function(){d=!0,e=0,h.dirty=!0},h.stopHighlighting=function(){d=!1,e=0,h.dirty=!0},f={},Object.defineProperty(h,"text",{get:function(){return void 0!==m&&f[m]?f[m].paragraphs:f.english?f.english.paragraphs:(BLOCKS.warn("No english version of this text exists."),[])},set:function(a){var b;if("string"==typeof a)f.english={},f.english.paragraphs=[a],f.english.paragraphs=f.english.paragraphs.slice(0);else if(Array.isArray(a))f.english={},f.english.paragraphs=a,f.english.paragraphs=f.english.paragraphs.slice(0);else for(b in a)a.hasOwnProperty(b)&&(f[b]={},f[b].paragraphs=a[b],"string"==typeof f[b].paragraphs&&(f[b].paragraphs=[f[b].paragraphs]),f[b].paragraphs=f[b].paragraphs.slice(0));o(),h.dirty=!0}}),Object.defineProperty(h,"numLines",{get:function(){return b}}),function(){var b=function(){var a=window.navigator.userAgent;return a.indexOf("MSIE ")>0?!0:a.indexOf("Trident/")>0?!0:a.indexOf("Edge/")>0?!0:!1};a=a||{},h.fontColor=a.fontColor||a.color||"#000000",h.fontFamily=a.fontFamily||"Arial,sans",h.fontSize=a.fontSize&&Number(a.fontSize.toString().replace("px",""))||24,h.fontWeight=a.fontWeight,h.fontItalic=a.fontItalic,h.textAlign=a.textAlign||a.align||"left",h.textBaseline=a.textBaseline||"top",h.lineHeight=a.lineHeight||h.fontSize,h.paragraphSpacing=a.paragraphSpacing||10,h.highlightColor=a.highlightColor||"#999999",h.text=a.text||"",g=b()}(),h};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.tileCollection=function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l=BLOCKS.eventDispatcher(),m=[],n=[],o=[],p=[],q=function(a){var b;for(a.removeEventListener("destroyed",q),b=0;b<p.length;b+=1){p.splice(b,1);break}},r=function(){var d;if(a.tiles){for(d=0;d<a.tiles.length;d+=1)a.tiles[d].id?m[a.tiles[d].id]=a.tiles[d]:m[d]=a.tiles[d],a.tiles[d].image&&(b=a.tiles[d].image.width);a.tiles[0].image&&(b=a.tiles[0].image.width,c=a.tiles[0].image.height)}else BLOCKS.error("No tiles specified in tile collection.");a.order?n=a.order:BLOCKS.error("No tile order specified in tile collection.")},s=function(d){var f;b&&c?(f={x:-(d.camera.x*j-b*d.column),y:-(d.camera.y*j-c*d.row)},d.image=m[d.id].image,f.x+g+d.camera.offsetX<0?(d.sourceX=g-f.x+d.camera.offsetX,d.destX=0,d.sourceWidth=f.x+b>d.camera.width+d.camera.offsetX?d.camera.width:b+f.x-d.camera.offsetX):f.x+b>g+d.camera.offsetX+d.camera.width?(d.sourceX=0,d.destX=f.x+g-d.camera.offsetX,d.sourceWidth=d.camera.width+d.camera.offsetX-(f.x+g)):(d.sourceX=0,d.destX=g-d.camera.offsetX+f.x,d.sourceWidth=b),f.y+h+d.camera.offsetY<0?(d.sourceY=-f.y-h+d.camera.offsetY,d.destY=0,d.sourceHeight=f.y+c>d.camera.height?d.camera.height:c-f.y):f.y+c>h+d.camera.offsetY+d.camera.height?(d.sourceY=0,d.destY=f.y+h-d.camera.offsetY,d.sourceHeight=d.camera.height+d.camera.offsetY-(f.y+h)):(d.sourceY=0,d.destY=h-d.camera.offsetY+f.y,d.sourceHeight=c),d.destWidth=d.sourceWidth,d.destHeight=d.sourceHeight,d.sourceWidth&&d.sourceHeight&&l.layer.ctx.drawImage(d.image,d.sourceX,d.sourceY,d.sourceWidth,d.sourceHeight,d.destX/e.scale,d.destY/e.scale,d.destWidth/e.scale,d.destHeight/e.scale)):a.tiles[0].image&&(b=a.tiles[0].image.width,c=a.tiles[0].image.height)};return a=a||{},l.update=function(){},l.render=function(a){var e,m,o,p,q,r,t,u,v;if(d&&i){for(v=l.layer.ctx.globalAlpha,l.layer.ctx.globalAlpha=f,o=Math.floor((a.camera.x*j-g)/b),p=k?Math.ceil((a.camera.x+a.camera.width+a.camera.offsetX)/b)-1:Math.floor((a.camera.x*j+a.camera.width+a.camera.offsetX)/b),q=Math.floor((a.camera.y*j-h)/c),r=Math.floor((a.camera.y*j-h+a.camera.height+a.camera.offsetY)/c),e=o;p>=e;e+=1)for(m=q;r>=m;m+=1)t=k&&n[m]?e>=n[m].length?e%n[m].length:e:e,u=m,n&&n[u]&&n[u][t]&&s({id:n[u][t],row:m,column:e,camera:{x:a.camera.x,y:a.camera.y,offsetX:a.camera.offsetX,offsetY:a.camera.offsetY,width:a.camera.width,height:a.camera.height}});l.layer.ctx.globalAlpha=v}d=!1},l.show=function(){l.visible=!0},l.hide=function(){l.visible=!1},l.isPointInside=function(a){var b;for(b=0;b<o.length;b+=1)if(o[b].visible&&o[b].isPointInside(a))return!0;return!1},l.motorize=function(a){a.addEventListener("destroyed",q),p.push(a)},l.removeMotors=function(a){var b,c=[];for(b=0;b<p.length;b+=1)a?p[b].type===a?p[b].destroy():c.push(p[b]):p[b].destroy();p=c},l.destroy=function(b){var c,d;if(b&&b.resetSrc&&a.tiles)for(c=0;c<a.tiles.length;c+=1)a.tiles[c].image&&(d=a.tiles[c].image.src,a.tiles[c].image.src=null,a.tiles[c].image.src=d);for(c=0;c<o.length;c+=1)o[c].destroy();o=[],l=null},Object.defineProperty(l,"dirty",{get:function(){return d},set:function(a){d!==a&&(d=a)}}),f=a.alpha||1,Object.defineProperty(l,"alpha",{get:function(){return void 0!==f?f:1},set:function(a){f!==a&&(1e-4>a?a=0:a>.9999&&(a=1),f=a,d=!0)}}),Object.defineProperty(l,"width",{get:function(){return n[0].length*b}}),Object.defineProperty(l,"height",{get:function(){return n.length*c}}),g=a.x||0,Object.defineProperty(l,"x",{get:function(){return g},set:function(a){g!==a&&(g=a,d=!0)}}),h=a.y||0,Object.defineProperty(l,"y",{get:function(){return h},set:function(a){h!==a&&(h=a,d=!0)}}),e=a.layer,Object.defineProperty(l,"layer",{get:function(){return e},set:function(a){e!==a&&(e=a,d=!0)}}),i=a.visible||!0,Object.defineProperty(l,"visible",{get:function(){return i},set:function(a){i!==a&&(i=a,d=!0)}}),j=a.speed||1,Object.defineProperty(l,"speed",{get:function(){return j},set:function(a){j!==a&&(j=a)}}),k=a.loopX,Object.defineProperty(l,"loopX",{get:function(){return k},set:function(a){k!==a&&(k=a)}}),Object.defineProperty(l,"tileWidth",{get:function(){return b}}),Object.defineProperty(l,"tileHeight",{get:function(){return c}}),r(),l};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.toolbox={},BLOCKS.toolbox.angle=function(a,b){"use strict";var c,d=b.x-a.x,e=b.y-a.y;return 0===d?c=e>0?Math.PI/2:-Math.PI/2:(c=Math.atan(e/d),e>0?0>d&&(c=Math.PI+c):c=0>d?Math.PI+c:2*Math.PI+c),c},BLOCKS.toolbox.randomizeArr=function(a){var b,c,d;for(b=a.length;b;c=parseInt(Math.random()*b,10),d=a[--b],a[b]=a[c],a[c]=d);},BLOCKS.toolbox.isPointInsideRect=function(a,b){return a.x>b.x&&a.x<b.x+b.width&&a.y>b.y&&a.y<b.y+b.height},BLOCKS.toolbox.isRectInsideRect=function(a,b){return a.x+a.width>b.x&&a.x<b.x+b.width&&a.y+a.height>b.y&&a.y<b.y+b.height},BLOCKS.toolbox.dist=function(a,b){"use strict";var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)},BLOCKS.toolbox.vector=function(a,b){var c={x:a,y:b};return c.scale=function(a){return c.x*=a,c.y*=a,c},c.normalize=function(){return c.scale(1/c.magnitude())},c.magnitude=function(){return Math.sqrt(c.x*c.x+c.y*c.y)},c},BLOCKS.toolbox.sum=function(a,b){return{x:a.x+b.x,y:a.y+b.y}},BLOCKS.toolbox.diff=function(a,b){return{x:a.x-b.x,y:a.y-b.y}},BLOCKS.toolbox.dot=function(a,b){return a.x*b.x+a.y*b.y};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.log=function(a){window.console&&window.console.log&&window.console.log(a)},BLOCKS.warn=function(a){window.console&&(window.console.warn?window.console.warn(a):window.console.log&&window.console.log(a))},BLOCKS.debug=function(a){window.console&&(window.console.debug?window.console.debug(a):window.console.log&&window.console.log(a))},BLOCKS.error=function(a){window.console&&(window.console.error?window.console.error(a):window.console.log&&window.console.log(a))},BLOCKS.dir=function(a){window.console&&(window.console.dir?window.console.dir(a):window.console.log&&window.console.log(a))};var BLOCKS;void 0===BLOCKS&&(BLOCKS={}),BLOCKS.view=function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=BLOCKS.eventDispatcher(),s=[],t=function(a){var b;for(a.removeEventListener("destroyed",t),b=0;b<s.length;b+=1){s[b]===a&&s.splice(b,1);break}};return r.update=function(){},r.render=function(){r.dirty=!1},r.show=function(){r.visible||(r.dirty=!0),r.visible=!0},r.hide=function(){r.visible&&(r.dirty=!0),r.visible=!1},r.motorize=function(a){a.addEventListener("destroyed",t),s.push(a)},r.removeMotors=function(a){var b,c=[],d=[];for(b=0;b<s.length;b+=1)a?s[b].type===a?c.push(s[b]):d.push(s[b]):c.push(s[b]);for(b=0;b<c.length;b+=1)c[b].destroy();s=d},r.isPointInside=function(a){var b,c=r.getBounds(),d=!1;if(!a)return BLOCKS.warn("view.isPointInside point is falsy: "+a),void 0;for(c.length||(c=[c]),b=0;b<c.length;b+=1)if(a.x>=c[b].x&&a.x<=c[b].x+c[b].width&&a.y>=c[b].y&&a.y<=c[b].y+c[b].height){d=!0;break}return d},r.getBounds=function(){var a,b,c,d,e,f,g,h;if(e=r.worldX,f=r.worldY,g=void 0!==r.cropWidth?r.cropWidth:r.width,h=void 0!==r.cropHeight?r.cropHeight:r.height,r.hotspots||r.minHotspot){if(b=[],r.hotspots)for(a=0;a<r.hotspots.length;a+=1)b.push({x:e+r.offsetX+r.hotspots[a].x,y:f+r.offsetY+r.hotspots[a].y,width:r.hotspots[a].width,height:r.hotspots[a].height});r.minHotspot&&(c=g<r.minHotspot?r.minHotspot-g:0,d=h<r.minHotspot?r.minHotspot-h:0,b.push({x:e+r.offsetX-c/2,y:f+r.offsetY-d/2,width:g+c,height:h+d})),1===b.length&&(b=b[0])}else b={x:e+r.offsetX,y:f+r.offsetY,width:g,height:h};return b},r.getBoundingBox=function(){return{x:r.worldX+r.offsetX,y:r.worldY+r.offsetY,width:void 0!==r.cropWidth?r.cropWidth:r.width,height:void 0!==r.cropHeight?r.cropHeight:r.height}},r.isRectInside=function(a){var b,c,d;if(!a)return BLOCKS.warn("view.isRectangleInside rect is falsy: "+a),!1;for(d=r.getBounds(),d.length||(d=[d]),b=0;b<d.length;b+=1)if(a.x+a.width>d[b].x&&a.x<d[b].x+d[b].width&&a.y+a.height>d[b].y&&a.y<d[b].y+d[b].height){c=!0;break}return c},r.destroy=function(){r&&(r.removeMotors(),r.dispatchEvent("destroyed",r),r=null)},function(){a=a||{},r.name=a.name,r.dirty=!0,p=a.stack,Object.defineProperty(r,"stack",{get:function(){return p},set:function(a){p!==a&&(r.dirty=!0,p=a)}}),Object.defineProperty(r,"worldX",{get:function(){return r.stack?r.stack.x+r.x:r.x},set:function(a){r.x!==a&&(r.dirty=!0,r.x=r.stack?a-r.stack.x:a)}}),Object.defineProperty(r,"worldY",{get:function(){return r.stack?r.stack.y+r.y:r.y},set:function(a){r.y!==a&&(r.dirty=!0,r.y=r.stack?a-r.stack.y:a)}}),Object.defineProperty(r,"scale",{get:function(){return i===j?i:{x:i,y:j}},set:function(a){(a!==i||a!==j)&&(r.dirty=!0,i=a,j=a)}}),i=void 0!==a.scaleX?a.scaleX:void 0!==a.scale?a.scale:1,Object.defineProperty(r,"scaleX",{get:function(){return i},set:function(a){i!==a&&(r.dirty=!0,i=a)}}),j=void 0!==a.scaleY?a.scaleY:void 0!==a.scale?a.scale:1,Object.defineProperty(r,"scaleY",{get:function(){return j},set:function(a){j!==a&&(r.dirty=!0,j=a)}}),d=a.width||0,Object.defineProperty(r,"width",{get:function(){return d*r.scaleX},set:function(a){d!==a/r.scaleX&&(r.dirty=!0,d=a/r.scaleX)}}),e=a.height||0,Object.defineProperty(r,"height",{get:function(){return e*r.scaleY},set:function(a){e!==a/r.scaleY&&(r.dirty=!0,e=a/r.scaleY)}}),f=a.offsetX||0,Object.defineProperty(r,"offsetX",{get:function(){return r.centerRegistrationPoint?-r.width/2:f*i},set:function(a){f!==a&&(r.dirty=!0,f=a)}}),g=a.offsetY||0,Object.defineProperty(r,"offsetY",{get:function(){return r.centerRegistrationPoint?-r.height/2:g*j},set:function(a){g!==a&&(r.dirty=!0,g=a)}}),h=a.angle||0,Object.defineProperty(r,"angle",{get:function(){return h},set:function(a){a%=360,0>a&&(a=360+a),h!==a&&(r.dirty=!0,h=a)}}),b=a.x||0,Object.defineProperty(r,"x",{get:function(){return b},set:function(a){b!==a&&(r.dirty=!0,b=a)}}),c=a.y||0,Object.defineProperty(r,"y",{get:function(){return c},set:function(a){c!==a&&(r.dirty=!0,c=a)}}),k=void 0!==a.alpha?a.alpha:1,Object.defineProperty(r,"alpha",{get:function(){return k},set:function(a){k!==a&&(1e-4>k?k=0:k>.9999&&(k=1),r.dirty=!0,k=a)}}),l=void 0!==a.visible?a.visible:!0,Object.defineProperty(r,"visible",{get:function(){return l},set:function(a){l!==a&&(r.dirty=!0,l=a)}}),m=a.layer,Object.defineProperty(r,"layer",{get:function(){return m},set:function(a){m!==a&&(r.dirty=!0,m=a)}}),n=a.hotspots,Object.defineProperty(r,"hotspots",{get:function(){return n},set:function(a){n!==a&&(r.dirty=!0,n=a)}}),o=a.minHotspot,Object.defineProperty(r,"minHotspot",{get:function(){return o},set:function(a){o!==a&&(r.dirty=!0,o=a)}}),q=a.centerRegistrationPoint||!1,Object.defineProperty(r,"centerRegistrationPoint",{get:function(){return q},set:function(a){q!==a&&(r.dirty=!0,q=a)}})}(),r},BLOCKS.key=function(a){"use strict";var b=BLOCKS.eventDispatcher();return b.name=a.name,b.keyCode=a.keyCode,b.layer=a.layer,b.x=a.x||0,b.y=a.y||0,b.width=a.width||80,b.height=a.height||80,b.scale=a.scale||1,b.visible=a.visible||!1,b.alpha=a.alpha||1,b.color=a.color||"#333",b.textColor=a.textColor||"#eee",b.dirty=!0,b.update=function(){},b.render=function(){b.dirty&&b.visible&&(b.layer.ctx.save(),b.layer.ctx.globalAlpha=b.alpha,b.layer.ctx.fillStyle=b.color,b.layer.ctx.fillRect(b.x,b.y,b.width,b.height),b.layer.ctx.fillStyle=b.textColor,b.layer.ctx.font="bold 24px sans-serif",b.layer.ctx.textAlign="center",b.layer.ctx.fillText(b.name,b.x+b.width/2,b.y+b.height/2+7),b.layer.ctx.restore())},b.destroy=function(){b=null},b},BLOCKS.virtualKeyboard=function(a,b){"use strict";var c=BLOCKS.eventDispatcher(),d=b.layer,e=[[{name:"1",keyCode:49},{name:"2",keyCode:50},{name:"3",keyCode:51},{name:"4",keyCode:52},{name:"5",keyCode:53},{name:"6",keyCode:54},{name:"7",keyCode:55},{name:"8",keyCode:56},{name:"9",keyCode:57},{name:"0",keyCode:48}]],f=[],g=function(){var a,g,h,i=20,j=20;if(b.customKeys)for(a=0;a<b.customKeys.length;a+=1)e.push(b.customKeys[a]);for(a=0;a<e.length;a+=1)for(g=0;g<e[a].length;g+=1)e[a][g].layer=d,h=BLOCKS.key(e[a][g]),h.width=h.width*h.scale,h.scale<1&&(h.width+=(h.scale-1)*j*g),h.x=c.x+i+h.width*g,g<=e[a].length-1&&(h.x+=j*g),h.y=c.y+i+h.height*a,a<=e.length-1&&(h.y+=j*a),f.push(h)};return c.x=b.x||0,c.y=b.y||0,c.width=b.width||640,c.height=b.height||480,c.dirty=!1,c.alpha=.8,c.visible=!1,c.update=function(){var a;for(a=0;a<f.length;a+=1)f[a].update()},c.render=function(){var a;if(c.dirty){for(d.clear(),a=0;a<f.length;a+=1)f[a].visible=c.visible,f[a].dirty=!0;c.visible&&(d.ctx.save(),d.ctx.globalAlpha=c.alpha,d.ctx.fillStyle="white",d.ctx.fillRect(c.x,c.y,c.width,c.height),d.ctx.restore()),c.dirty=!1}for(a=0;a<f.length;a+=1)f[a].render()},c.destroy=function(){var a;for(a=0;a<f.length;a+=1)f[a].destroy()},c.onTap=function(b){var d;if(c.visible)for(d=0;d<f.length;d+=1)if(BLOCKS.toolbox.isPointInsideRect(b,f[d])){a.simulateKeyDownEvent(f[d].keyCode);break}c.visible=!1,c.dirty=!0},g(),c};